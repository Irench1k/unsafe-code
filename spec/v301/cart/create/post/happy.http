# @import ../_imports.http

# POST /cart happy path (v301+)
# Cart creation across auth methods and restaurants
#
# v301: Multi-restaurant model (requires restaurant_id parameter)
#
# Exports (for @forceRef by other tests):
#   new_cart - Patrick's cart at Krusty Krab (canonical fixture)
#   chum_bucket_cart - Cart at Chum Bucket (for multi-tenant tests)

### Create cart with Basic Auth (canonical fixture for downstream tests)
# @name new_cart
# @tag cart, happy, r03, v301
POST /cart?restaurant_id=1
Authorization: {{auth.basic("patrick")}}

@cart_id = {{$(response).field("cart_id")}}
?? js $(response).status() == 201
?? js $(response).hasFields("cart_id", "restaurant_id", "items") == true
?? js $(response).field("restaurant_id") == 1

### Create cart with Cookie Auth
# @tag cart, happy, r03, v301
POST /cart?restaurant_id=1
Cookie: {{auth.login("patrick")}}

?? js $(response).status() == 201
?? js $(response).hasFields("cart_id", "restaurant_id", "items") == true
?? js $(response).field("restaurant_id") == 1

### Create cart for different user (plankton)
# @tag cart, happy, r03, v301
POST /cart?restaurant_id=1
Authorization: {{auth.basic("plankton")}}

?? js $(response).status() == 201
?? js $(response).hasFields("cart_id", "restaurant_id", "items") == true
?? js $(response).field("restaurant_id") == 1

### Create cart for different restaurant (Chum Bucket)
# @name chum_bucket_cart
# @tag cart, happy, r03, v301
POST /cart?restaurant_id=2
Authorization: {{auth.basic("plankton")}}

@cart_id_chum = {{$(response).field("cart_id")}}
?? js $(response).status() == 201
?? js $(response).hasFields("cart_id", "restaurant_id", "items") == true
?? js $(response).field("restaurant_id") == 2
