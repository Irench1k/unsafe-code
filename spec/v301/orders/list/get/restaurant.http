# @import ../_imports.http
# @import ../../../cart/checkout/post/~happy.http

# GET /orders restaurant-scoped listings (v301+)
# Restaurant manager access via API key

### Krusty Krab sees only their restaurant's orders
# @forceRef new_order
# @tag orders, r03, v301
GET /orders
X-API-Key: {{auth.restaurant("krusty_krab")}}

?? js $(response).isOk() == true
?? js $(response).every(o => o.restaurant_id === 1) == true

### Customer cookie takes precedence over restaurant key
# @ref new_order
# @tag orders, r03, v301
GET /orders
Cookie: {{auth.login("patrick")}}
X-API-Key: key-krusty-krub-wrongkey

?? js $(response).isOk() == true
?? js $(response).hasOnlyUserData("patrick") == true

### Customer cookie takes precedence over restaurant header
# @ref new_order
# @tag orders, r03, v301
GET /orders
Cookie: {{auth.login("patrick")}}
X-API-Key: {{auth.restaurant("krusty_krab")}}

?? js $(response).isOk() == true
