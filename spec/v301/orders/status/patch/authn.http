# @import ../_imports.http
# @import ./happy.http

# PATCH /orders/{id}/status authentication guardrails
# Order status updates require valid customer or restaurant authentication

# =============================================================================
# UNAUTHENTICATED REQUESTS
# =============================================================================

### Status update without auth fails
# @forceRef plankton_order
# @tag authn, orders, r03, v301
PATCH /orders/{{order_id}}/status
Content-Type: application/x-www-form-urlencoded

status=cancelled

?? js $(response).isError() == true
?? js $(response).field("error") == Authentication required

# =============================================================================
# INVALID CREDENTIALS
# =============================================================================

### Status update with wrong password fails - Basic Auth
# @ref plankton_order
# @tag authn, orders, r03, v301
PATCH /orders/{{order_id}}/status
Authorization: {{auth.basic("plankton", "wrongpassword")}}
Content-Type: application/x-www-form-urlencoded

status=cancelled

?? js $(response).isError() == true
?? js $(response).field("error") == Authentication required

### Status update with invalid cookie fails
# @ref plankton_order
# @tag authn, orders, r03, v301
PATCH /orders/{{order_id}}/status
Cookie: session=invalid-session-cookie-12345
Content-Type: application/x-www-form-urlencoded

status=cancelled

?? js $(response).isError() == true

### Status update with invalid API key fails
# @ref plankton_order
# @tag authn, orders, r03, v301
PATCH /orders/{{order_id}}/status
X-API-Key: invalid-api-key-12345
Content-Type: application/x-www-form-urlencoded

status=delivered

?? js $(response).isError() == true
