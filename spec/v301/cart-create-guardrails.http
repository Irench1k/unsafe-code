# @import ../common.http

# POST /cart guardrails
# Tests authentication and validation requirements

# =============================================================================
# AUTHENTICATION REQUIRED
# =============================================================================

### Create cart requires authentication
# @tag ci, r03, vulnerable
POST /cart?restaurant_id=1

?? js $(response).isError() == true
?? js $(response).field("error") == Authentication required

### Create cart requires valid credentials
# @tag ci, r03, vulnerable
POST /cart?restaurant_id=1
Authorization: Basic {{user("plankton").email}}:wrongpassword

?? js $(response).isError() == true
?? js $(response).field("error") == Authentication required

# =============================================================================
# RESTAURANT VALIDATION
# =============================================================================

### Create cart requires restaurant_id - Basic Auth
# @tag ci, r03, vulnerable
POST /cart
Authorization: {{auth.basic("spongebob")}}

?? js $(response).isError() == true

### Create cart requires restaurant_id - Cookie Auth
# @tag ci, r03, vulnerable
POST /cart
Cookie: {{auth.login("spongebob")}}

?? js $(response).isError() == true

### Create cart requires valid restaurant_id
# @tag ci, r03, vulnerable
POST /cart?restaurant_id=999
Authorization: {{auth.basic("spongebob")}}

?? js $(response).isError() == true
