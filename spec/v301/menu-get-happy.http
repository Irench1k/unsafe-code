# @import ../common.http

# GET /menu happy path

### Menu is publicly accessible (no auth required)
# @tag ci, r03, vulnerable
GET /menu

?? js $(response).isOk() == true
?? js $(response).count() > 0
?? js $(response).hasFields("id", "name", "price", "available", "restaurant_id") == true

### Menu can be filtered by restaurant_id
# @tag ci, r03, vulnerable
GET /menu?restaurant_id=1

?? js $(response).isOk() == true
?? js $(response).every(item => item.restaurant_id === 1) == true

### Menu can be filtered by restaurant_id (chum bucket)
# @tag ci, r03, vulnerable
GET /menu?restaurant_id=2

?? js $(response).isOk() == true
?? js $(response).every(item => item.restaurant_id === 2) == true

### Menu is accessible with auth headers (they're ignored)
# @tag ci, r03, vulnerable
GET /menu
Authorization: {{auth.basic("patrick")}}

?? js $(response).isOk() == true
?? js $(response).count() > 0

### Menu is accessible with cookie auth
# @tag ci, r03, vulnerable
GET /menu
Cookie: {{auth.login("squidward")}}

?? js $(response).isOk() == true
?? js $(response).count() > 0

### Incorrect restaurant_id fails
# @tag ci, r03, vulnerable
GET /menu?restaurant_id=999

?? js $(response).isError() || $(response).isEmpty() == true
