# @import ../common.http

# GET /menu happy path
# Tests public menu access and restaurant filtering

# =============================================================================
# PUBLIC ACCESS: No authentication required
# =============================================================================

### Menu is publicly accessible with expected fields
# @name menu
GET /menu

?? js $(response).isOk() == true
?? js $(response).count() > 0
?? js $(response).hasFields("id", "name", "price", "available", "restaurant_id") == true

### Menu works with Basic Auth (ignored)
# @ref menu
# @tag ci, r03, vulnerable
GET /menu
Authorization: {{auth.basic("patrick")}}

?? js $(response).isOk() == true
?? js $(response).count() > 0

### Menu works with Cookie Auth (ignored)
# @ref menu
# @tag ci, r03, vulnerable
GET /menu
Cookie: {{auth.login("squidward")}}

?? js $(response).isOk() == true
?? js $(response).count() > 0

# =============================================================================
# RESTAURANT FILTERING
# =============================================================================

### Filter by Krusty Krab (restaurant_id=1)
# @tag ci, r03, vulnerable
GET /menu?restaurant_id=1

?? js $(response).isOk() == true
?? js $(response).every(item => item.restaurant_id === 1) == true

### Filter by Chum Bucket (restaurant_id=2)
# @tag ci, r03, vulnerable
GET /menu?restaurant_id=2

?? js $(response).isOk() == true
?? js $(response).every(item => item.restaurant_id === 2) == true

### Invalid restaurant_id returns error or empty
# @tag ci, r03, vulnerable
GET /menu?restaurant_id=999

?? js $(response).isError() || $(response).isEmpty() == true
