# @import ../_imports.http
# @import ../../login/post/happy.http

# POST /auth/logout authentication guardrails
# Cannot logout without being logged in first

# =============================================================================
# UNAUTHENTICATED REQUESTS
# =============================================================================

### Logout without any auth fails
{{
  await platform.reset();
}}
# @tag auth, authn, r03, v301
POST /auth/logout

?? js $(response).isError() == true
?? js $(response).field("error") != null

### Logout with invalid cookie fails
# @tag auth, authn, r03, v301
POST /auth/logout
Cookie: session=invalid-session-cookie-12345

?? js $(response).isError() == true

# =============================================================================
# VALID AUTH METHODS FOR LOGOUT
# =============================================================================

### Logout works with Basic Auth
# @tag auth, authn, r03, v301
POST /auth/logout
Authorization: {{auth.basic("spongebob")}}

?? js $(response).isOk() == true
?? js $(response).field("message") == Logout successful

### Logout with valid session succeeds
# @forceRef login_success
# @tag auth, authn, r03, v301
POST /auth/logout
Cookie: {{sessionCookie}}

?? js $(response).isOk() == true
?? js $(response).field("message") == Logout successful
