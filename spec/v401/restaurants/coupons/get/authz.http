# @import ../_imports.http

# =============================================================================
# Authorization Tests: GET /restaurants/<id>/coupons
# =============================================================================
#
# ENDPOINT: GET /restaurants/<id>/coupons
# PURPOSE: Verify restaurants can only access their own coupons
#
# Tests that restaurant managers can only see coupons for restaurants they manage.
# Cross-tenant access should be denied.
# =============================================================================

### Seed the database
# @name seed
{{
  await platform.seed();
}}
# @ucskip
# @tag authz, r04, restaurants, v401
GET /restaurants

# =============================================================================
# TEST: Krusty Krab cannot access Chum Bucket coupons
# =============================================================================

### Krusty Krab API key cannot access Chum Bucket coupons
# @name krusty_cannot_access_chum
# @forceRef seed
# @ucskip
# @tag authz, r04, restaurants, v401
GET /restaurants/2/coupons
X-API-Key: {{auth.restaurant("krusty_krab")}}

?? js $(response).isError() == true

# =============================================================================
# TEST: Chum Bucket cannot access Krusty Krab coupons
# =============================================================================

### Chum Bucket API key cannot access Krusty Krab coupons
# @name chum_cannot_access_krusty
# @forceRef seed
# @ucskip
# @tag authz, r04, restaurants, v401
GET /restaurants/1/coupons
X-API-Key: {{auth.restaurant("chum_bucket")}}

?? js $(response).isError() == true
