# @import ../_imports.http

# GET /account/credits happy path
# View user balance with different auth methods
#
# v205 users: sandy, patrick, plankton, spongebob (no squidward/mrkrabs)
#
# Exports (for @forceRef by other tests):
#   balance_plankton - Plankton's balance (Basic Auth)
#   balance_cookie - SpongeBob's balance (Cookie Auth)

### View balance with Basic Auth
# @name balance_plankton
{{
  await platform.seed({ plankton: 200, spongebob: 150 });
}}
# @tag account, happy, r02, v205
GET /account/credits
Authorization: {{auth.basic("plankton")}}

?? js $(response).status() == 200
?? js $(response).hasFields("email", "balance") == true
?? js parseFloat($(response).field("balance")) == 200

### View balance with Cookie Auth
# @name balance_cookie
{{
  exports.spongebob_session = await auth.login("spongebob");
}}
# @tag account, happy, r02, v205
GET /account/credits
Cookie: {{spongebob_session}}

?? js $(response).status() == 200
?? js $(response).hasFields("email", "balance") == true
?? js parseFloat($(response).field("balance")) == 150
