version: '1'
root: .
category: confusion
namespace: flask-confusion-cross-component-parse
examples:
  1:
    id: 1
    kind: block
    title: Secure Baseline with Verbose Inline Authentication
    notes: >-
      Demonstrates secure but repetitive authentication. Every endpoint validates credentials
      inline with 4-6 lines of identical logic before executing business operations. This
      verbose pattern creates pressure to refactor into middleware or decorators, as shown
      in subsequent examples.
    http: null
    language: python
    parts:
    - part: 1
      file: e01_baseline/routes.py
      code_start_line: 26
      code_end_line: 147
    file_hashes:
      e01_baseline/routes.py: cf1195689a089b57d12387b9c22937299cba377b7e2ada4867303fd4464535c0
    fingerprint: f9d3fe74e12e31898efec2c81d2083b4b6669462ca5f0f3edce3f0b7a2809a70
  2:
    id: 2
    kind: block
    title: Middleware with Source Precedence Bug
    notes: >-
      Blueprint middleware validates credentials and stores the authenticated user in g.user.
      Most endpoints correctly use g.user, but profile/view accidentally reads profile_owner
      from request.args (query string) while middleware authenticates from request.form (body).


      An attacker authenticates with their credentials in the form body, then specifies a
      victim's username in the query string to view their profile.
    http: null
    language: python
    parts:
    - part: 1
      file: e02_middleware/routes.py
      code_start_line: 39
      code_end_line: 108
    file_hashes:
      e02_middleware/routes.py: 89609e1aade5993864296fe37a07a95cc7e42dceac655956bd67a0afa4c1e4ee
    fingerprint: f714da48dd4f6bfb1380f824b2167941e18a18e22763fd8d1739589f1e3143ca
  3:
    id: 3
    kind: block
    title: Decorator with request.values Confusion
    notes: >-
      Authentication decorator uses request.values for "flexibility", which combines args
      and form with args taking precedence. Middleware sets g.user from request.form only.


      Attack: Provide credentials in query string (args), victim's name in form body. Decorator
      authenticates attacker via request.values (finds args first), middleware sets g.user
      from form (victim's name), handler operates on g.user (victim).
    http: null
    language: python
    parts:
    - part: 1
      file: e03_decorator/routes.py
      code_start_line: 50
      code_end_line: 79
    file_hashes:
      e03_decorator/routes.py: cf0edecab4bfa953ce763e949836419a68aa5a53cda557a3e594f41677578d33
    fingerprint: 5b38dfd45151f331dec49154663d3705c4f1b637dfdb69aa5c8a42f39e75901a
  4:
    id: 4
    kind: block
    title: Handler Copies Old Decorator Logic
    notes: >-
      The decorator was fixed to reuse g.user from middleware, eliminating precedence confusion.
      However, when adding delete_messages, a developer copied the OLD decorator's logic directly
      into the handler for "flexibility", reading credentials from request.args while middleware
      sets g.user from request.form.
    http: null
    language: python
    parts:
    - part: 1
      file: e04_decorator_reuses_g/routes.py
      code_start_line: 45
      code_end_line: 82
    file_hashes:
      e04_decorator_reuses_g/routes.py: f2c06b67248696c5881391b5f21f5e839499bc64b97acf67699c533f49a1db45
    fingerprint: 6da810fd9bd53945479d59f7ee22f8100d5807ed7c554b3440cccdf14c8fc88f
  5:
    id: 5
    kind: block
    title: Fail-Open Error Handler Leaks Passwords
    notes: >-
      Error handler maps known exceptions to safe messages but fails open for unexpected exceptions,
      revealing full error details. The validate_username_format function includes the full
      profile (with password) in RuntimeError exceptions.


      When an attacker provides a username with suspicious characters, it triggers an unknown
      exception type that leaks the password in the error response.
    http: null
    language: python
    parts:
    - part: 1
      file: e05_error_handler/routes.py
      code_start_line: 71
      code_end_line: 90
    file_hashes:
      e05_error_handler/routes.py: 884245e370aaa47809f45549ba0370533ee1855fe85c393fa8e2e11b27d3a74b
    fingerprint: caea18d6f820f4f12559ec0912a4e1488a428a67a94d002b2bcd71e81da988bb
  6:
    id: 6
    kind: block
    title: Basic Authentication with Query Parameter Bug
    notes: >-
      Modernized authentication using HTTP Basic Auth via Authorization header. Most endpoints
      correctly use g.user, but profile/view reads username from query string instead, enabling
      authenticated users to view any profile by specifying a different username in the URL.
    http: null
    language: python
    parts:
    - part: 1
      file: e06_basic_auth/routes.py
      code_start_line: 50
      code_end_line: 94
    file_hashes:
      e06_basic_auth/routes.py: 784dd769d9f8b3e2d771f67fee88e0a261b8cb262d9285f1cfb1156286d74506
    fingerprint: 3ad2dd621350afd2807069f2a31f142f8d24ccc3f6d62e0630399de48dba17e0
attachments:
  http/exploit-1.http: 92eb21911119576859205564f04392f403846ef24bcdd7080a29ec2fd0f0db0a
  http/exploit-2.http: b2fbde9d9d998251002f825b04e0cab7c114fda2cde32fce3b0ec34f8043021e
  http/exploit-3.http: f3131dafa00296c7eacde13f9988ba566fef842f615e053daa11cfdba3b89f6c
  http/exploit-4.http: d26251fdde6d5f1554b053efee6ffd34e3019604d188594bc14974600400c5af
  http/exploit-5.http: 17b30cb68e38179e12a0282b56b14fba952b207d94d3a510c54b634f16a8091f
  http/exploit-6.http: 2d29a8961ef55b76e3afbb8c8c0b0e6cb12fa8fe087a9084cdd890ce519de930
build_signature: bd87037a6264f67d6dad850183ab0f98ca5b630ede16100cdf0f32d1103b98c9
last_readme_fingerprint: 5e0c7c49bf262d97735534e2775f0ea2a1e4825ce5ffee2049883db5e795b811
