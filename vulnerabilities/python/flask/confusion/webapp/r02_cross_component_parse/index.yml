version: '1'
root: .
category: ii.cross-component-parse
namespace: flask-ii-cross-component-parse
examples:
  1:
    id: 1
    kind: block
    title: Consistent Parameter Sourcing [Not Vulnerable]
    notes: >-
      This baseline demonstrates the secure pattern for handling authentication when decorators
      and handlers need to access the same user identity.


      THE SECURE PATTERN: Consistent parameter sourcing across all layers.

      - Authentication decorator validates credentials from request.args

      - Handler retrieves user identity from the SAME source (request.args)

      - Both layers use identical logic: request.args.get("user")

      - Result: Authentication and data access work on the same identity


      This prevents authentication bypass by ensuring that the identity validated during authentication
      is the exact same identity used for data access. There is no confusion between different
      request data sources.


      Compare this to the vulnerable examples that follow, where different layers source the
      user identity from different request properties, creating authentication bypass vulnerabilities.
    http: null
    language: python
    parts:
    - part: 1
      file: e01_baseline/routes.py
      code_start_line: 28
      code_end_line: 41
    - part: 2
      file: e01_baseline/decorator.py
      code_start_line: 9
      code_end_line: 26
    file_hashes:
      e01_baseline/decorator.py: 3351dc3ce99d5430d79ff87aac7851c9682675da2c7816f326b7eea0e274caab
      e01_baseline/routes.py: c6a4f807eac665058e67eddcf04f380fd17c3717ce72cf73d002847a799b45a5
    fingerprint: cc9722cb1e6ca6ebe365f24c71956d75bd54db3b5a2485be490355428798eebe
  2:
    id: 2
    kind: block
    title: Decorator-based Authentication with Parsing Drift
    notes: >-
      Shows how using decorators can obscure parameter source confusion, leading to authentication
      bypass.


      Example 2 is functionally equivalent to Example 4 from the source precedence examples,
      but it may be harder to spot the vulnerability when using decorators because the parameter
      source logic is split across multiple layers.


      THE VULNERABILITY: Authentication bypass via source precedence confusion.

      - Authentication decorator validates credentials from request.args (query string)

      - Handler retrieves user identity from get_user_ex2(), which prioritizes request.form

      - Attack: Provide SpongeBob's credentials in query string, Squidward's name in form
      body

      - Result: Authenticate as SpongeBob, but access Squidward's messages


      This is NOT authorization binding drift - it's authentication bypass because the authenticated
      identity itself gets confused between authentication check and data access.
    http: null
    language: python
    parts:
    - part: 1
      file: e02_decorator_drift/routes.py
      code_start_line: 28
      code_end_line: 34
    - part: 2
      file: e02_decorator_drift/decorator.py
      code_start_line: 9
      code_end_line: 23
    file_hashes:
      e02_decorator_drift/decorator.py: 21a90057887ec40d0fbacde26110d5f9f796399ddd8c30cb12bcb8c41e150a2f
      e02_decorator_drift/routes.py: 79a8960009f60d49b07decedfcc7ec2a70b872ff344b12b76e9a168fdd665760
    fingerprint: 0c04433c784dae80fee6e88bec81902c05ac0489791fab9382dc9822e6035fb3
  3:
    id: 3
    kind: block
    title: Middleware-based Authentication with Parsing Drift
    notes: >-
      Demonstrates how Flask's middleware system can contribute to parameter source confusion.


      Example 3 is functionally equivalent to Example 4 from the old parameter source confusion
      examples, but it may be harder to spot the vulnerability while using middleware.


      The before_request middleware authenticates using request.args.get("user"), but the
      handler retrieves the user via get_user(request) which prioritizes request.form over
      request.args. This allows an attacker to authenticate as SpongeBob but access Squidward's
      messages.
    http: null
    language: python
    parts:
    - part: 1
      file: e03_middleware_drift/routes.py
      code_start_line: 22
      code_end_line: 27
    - part: 2
      file: e03_middleware_drift/middleware.py
      code_start_line: 9
      code_end_line: 22
    file_hashes:
      e03_middleware_drift/middleware.py: e426011539f8710630f460fdcf1c5778b68a4ad7e4ca4c159f9831240f814f6c
      e03_middleware_drift/routes.py: aed01c24c03a314dfd53aa1e2a622bffc1cfaebd5818a0f1ebf7edfa70602cad
    fingerprint: 85d0ae1fe7c9dc15963ba38ad93c7aaa6b0a77f8624e507f4b1a73e301a6dba5
attachments:
  http/exploit-1.http: afc84bb67132164bc40dcd2c850beb21c894358ded6cc2859dc369442e764a2a
  http/exploit-2.http: c233ae057f1910328bf16d63176e9aef93579e0fdb54c77b7e9ae140d5945cda
  http/exploit-3.http: 6238c7915d2cc6c5d773bfe174a647e912f7a35d3d906d545969cc457716a0c0
build_signature: b36090941771417e7a9b76285c3a8074a769db088192c4b02b66963579e7440b
last_readme_fingerprint: 464d47c57855cc31ef97bbd24b0bba1bba7c5b3daca13435105f5bcf3b1aae65
