version: '1'
root: .
category: ii.source-precedence
namespace: flask-ii-source-precedence
examples:
  1:
    id: 1
    kind: function
    title: Secure Implementation
    notes: >-
      Here you can see a secure implementation that consistently uses query string parameters
      for both authentication and data retrieval.
    http: open
    language: python
    parts:
    - part: 1
      file: routes.py
      code_start_line: 38
      code_end_line: 56
    file_hashes:
      routes.py: a26e77e5ccf6d7a8922ee8ffea9a48fbafaabea3607dd5fdec7824610200d441
    fingerprint: 4116309554df717a886ba85c9199b957d6915233353a81664b686d5590623573
  2:
    id: 2
    kind: function
    title: Basic Parameter Source Confusion
    notes: >-
      Demonstrates the most basic form of parameter source confusion where authentication
      uses **query** parameters but data retrieval uses **form** data.


      We take the user name from the query string during the validation, but during the data
      retrieval another value is used, taken from the request body (form). This does not look
      very realistic, but it demonstrates the core of the vulnerability, we will build upon
      this further.


      Here you can see if we provide squidward's name in the request body, we can access his
      messages without his password.
    http: null
    language: python
    parts:
    - part: 1
      file: routes.py
      code_start_line: 73
      code_end_line: 92
    file_hashes:
      routes.py: a26e77e5ccf6d7a8922ee8ffea9a48fbafaabea3607dd5fdec7824610200d441
    fingerprint: ffebbc17156717b5b448c2d84293aba7e2943420c7695ab28b03b865155adf72
  3:
    id: 3
    kind: block
    title: Function-Level Parameter Source Confusion
    notes: >-
      Functionally equivalent to example 2, but shows how separating authentication and data
      retrieval into different functions can make the vulnerability harder to spot.
    http: open
    language: python
    parts:
    - part: 1
      file: routes.py
      code_start_line: 102
      code_end_line: 133
    file_hashes:
      routes.py: a26e77e5ccf6d7a8922ee8ffea9a48fbafaabea3607dd5fdec7824610200d441
    fingerprint: d3b0bcac352cd4e4c5737e6adb4fd243cb6d99add9e182264ea66ceb6a9b6389
  4:
    id: 4
    kind: block
    title: Cross-Module Parameter Source Confusion
    notes: >-
      In the previous example, you can still see that the `user` value gets retrieved from
      the `request.args` during validation but from the `request.form` during data retrieval.


      A more subtle example, where this is not immediately obvious (imagine, `authenticate_user`
      is defined in an another file altogether):
    http: null
    language: python
    parts:
    - part: 1
      file: routes.py
      code_start_line: 149
      code_end_line: 175
    file_hashes:
      routes.py: a26e77e5ccf6d7a8922ee8ffea9a48fbafaabea3607dd5fdec7824610200d441
    fingerprint: 113c4856ad6c7963aad5cc63d6502aabdc4ffee3c92d257e8e15c17648bc49a9
  5:
    id: 5
    kind: block
    title: Form-Query Priority Resolution
    notes: >-
      Shows how a helper function that implements source prioritization can create vulnerabilities.


      In Example 5 we don't need to specify body parameters to get a result (which is now
      more realistic!), but if we want, we can still access squidward's messages by passing
      his user name in the request body:
    http: null
    language: python
    parts:
    - part: 1
      file: routes.py
      code_start_line: 189
      code_end_line: 215
    file_hashes:
      routes.py: a26e77e5ccf6d7a8922ee8ffea9a48fbafaabea3607dd5fdec7824610200d441
    fingerprint: ce150622af11deb0769a0c7bbd0cc0e0e321d5aa0b0309e0a782ca61c4167b69
  6:
    id: 6
    kind: block
    title: Mixed-Source Authentication
    notes: >-
      Shows how authentication and data access can use different combinations of sources.


      This one is interesting, because you can access Squidward's messages by providing his
      username and SpongeBob's password in the request query, while providing SpongeBob's
      username in the request body:
    http: null
    language: python
    parts:
    - part: 1
      file: routes.py
      code_start_line: 229
      code_end_line: 253
    file_hashes:
      routes.py: a26e77e5ccf6d7a8922ee8ffea9a48fbafaabea3607dd5fdec7824610200d441
    fingerprint: adf36b2e5bd6951c2410fba9ab986c1952c26d7ee5eebb5e20781df52be1f041
  7:
    id: 7
    kind: block
    title: Form Authentication Bypass
    notes: >-
      The endpoint uses form data for authentication, but request.values.get() allows query
      parameters to override form values, creating a vulnerability. Although designed for
      POST requests, the endpoint accepts both GET and POST methods, enabling the attack.


      Note that although the regular usage would rely on POST request (or PUT, PATCH, etc.),
      and wouldn't work with GET (because flask's request.values ignores form data in GET
      requests), the attacker can send both GET and POST requests (if the endpoint is configured
      to accept both methods).


      ```http

      POST /ii/source-precedence/example7? HTTP/1.1

      Content-Type: application/x-www-form-urlencoded

      Content-Length: 35


      user=spongebob&password=bikinibottom

      ```


      However, the attacker can send both GET and POST requests (if the endpoint is configured
      to accept both methods).
    http: null
    language: python
    parts:
    - part: 1
      file: routes.py
      code_start_line: 277
      code_end_line: 303
    file_hashes:
      routes.py: a26e77e5ccf6d7a8922ee8ffea9a48fbafaabea3607dd5fdec7824610200d441
    fingerprint: 0bfe100601f6d2114dbf86d26bfd35defeb280ae7738544ff89fa9b39fa951a4
  8:
    id: 8
    kind: function
    title: Request.Values in Authentication
    notes: >-
      Demonstrates how using request.values in authentication while using form data for access
      creates vulnerabilities.


      This is an example of a varient of example 7, as we do the similar thing, but now we
      can pass Squidward's username in the request body with SpongeBob's password, while passing
      SpongeBob's username in the request query. Note that this example does not work with
      GET request, use POST.
    http: null
    language: python
    parts:
    - part: 1
      file: routes.py
      code_start_line: 317
      code_end_line: 336
    file_hashes:
      routes.py: a26e77e5ccf6d7a8922ee8ffea9a48fbafaabea3607dd5fdec7824610200d441
    fingerprint: b429086d384ce6e03a4989d5f36277a79a89da393b4ca4a2543a0963c062b6eb
attachments:
  http/exploit-1.http: 4522e674d263809ae7a971cbab3d9ebe864ea890f1a716a2550778ea4cf5d944
  http/exploit-2.http: b723d6bfd8637ff1bccab7b8675fd3b9d1bc4e7574d356992d0d8c3f0c564d51
  http/exploit-3.http: f7c4418c9e62ed60ef552f300dae2e57bcd758ebc6279586be10479113bfde4e
  http/exploit-4.http: a153c38ff885850977a9881f3fe2e40a7372a9004e3531430733aa72a958b8d8
  http/exploit-5.http: 03d889739e84d2c7f1beabd5371951c3bc182f8456bab26bc0a531adc55623b2
  http/exploit-6.http: 9186c05c647140cdff0bb94f347b3dc5b72d2734635ab81a9557ca4e74dd9def
  http/exploit-7.http: 97ae879501cad426e5fd6a50a7e2db1fcadcccc0ea12d80ba026f4ba385d2e5d
  http/exploit-8.http: 58b50c192b5d9624e7cb84e1a85d6fa119060db1866df1d7cf4a85b01642d07a
build_signature: c1bf2b28b9ece0e7416d33e33ea9c45aea14efd842e92cdc08fe88eca4b493d2
last_readme_fingerprint: 69a245961ea3ac46c20be7b1d3f0586f36ea3310571b1de73f03198446c80be6
