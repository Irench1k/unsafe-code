version: '1'
root: .
category: ii.source-precedence
namespace: flask-ii-source-precedence
examples:
  1:
    id: 1
    kind: function
    title: Secure Implementation
    notes: >-
      Here you can see a secure implementation that consistently uses form body parameters
      for both authentication and data retrieval.
    http: null
    language: python
    parts:
    - part: 1
      file: e00_intro/routes.py
      code_start_line: 32
      code_end_line: 45
    file_hashes:
      e00_intro/routes.py: 7eea4535f675709076642c1cf8ba1c6efa32755fdbb33acce81eeea3ffd7cd2e
    fingerprint: 108e4e8cd87aafd0de3b3b9476ef5e4feeae932829eb395508a0707beb0663b1
  2:
    id: 2
    kind: function
    title: Inline request.form vs request.args Confusion
    notes: >-
      Demonstrates the most basic form of parameter source confusion where authentication
      uses **form body** parameters but data retrieval uses **query string** parameters.


      Authentication validates credentials from the POST body (the secure practice), but message
      retrieval reads the target username from the query string. An attacker can authenticate
      with their own credentials in the body while specifying a victim's username in the URL
      to access that victim's messages.
    http: null
    language: python
    parts:
    - part: 1
      file: e00_intro/routes.py
      code_start_line: 60
      code_end_line: 71
    file_hashes:
      e00_intro/routes.py: 7eea4535f675709076642c1cf8ba1c6efa32755fdbb33acce81eeea3ffd7cd2e
    fingerprint: fd32ad65cb1cebfb742a886e1cbdbe37142ece33ee734bc79ecf4fd778ae42db
  3:
    id: 3
    kind: block
    title: Function-Level Parameter Source Confusion
    notes: >-
      Separating authentication and data retrieval into different functions can make the vulnerability
      harder to spot.
    http: null
    language: python
    parts:
    - part: 1
      file: e00_intro/routes.py
      code_start_line: 81
      code_end_line: 107
    file_hashes:
      e00_intro/routes.py: 7eea4535f675709076642c1cf8ba1c6efa32755fdbb33acce81eeea3ffd7cd2e
    fingerprint: b90cfdc6b2acf1f7b936dc0147d8a9a6ce6f4f5c4351ee6dfd2d375a9cbe9b48
  4:
    id: 4
    kind: block
    title: Cross-Module Parameter Source Confusion
    notes: >-
      Confusion becomes even harder to detect when business logic is split into separate modules.
      Here the auth module uses form-based credentials which is secure on its own but inconsistent
      with the `messages_get` receiving a query string parameter.


      Note that each file looks reasonable in isolation.
    http: null
    language: python
    parts:
    - part: 1
      file: e04_cross_module/routes.py
      code_start_line: 20
      code_end_line: 31
    - part: 2
      file: e04_cross_module/auth.py
      code_start_line: 10
      code_end_line: 17
    - part: 3
      file: e04_cross_module/db.py
      code_start_line: 8
      code_end_line: 16
    file_hashes:
      e04_cross_module/auth.py: 67d483a100c41992ab94bf5e5361b61df5e56fbc865d942857c624ebcd219505
      e04_cross_module/db.py: 11d44dbeda8a5b978bd18daeb182b4d69ccc843e118572dc51936850d8fbc375
      e04_cross_module/routes.py: 7303f1c12e146c3209de7c16eb7a71fe16a6af92f25a09d0b6e8d93b7ace556c
    fingerprint: 80a5ee411ac8fe1ca68d066bfdbeef13817c42eef77aa1552855a7248e518487
  5:
    id: 5
    kind: block
    title: Truthy-OR Parameter Precedence
    notes: >-
      Demonstrates a subtle vulnerability in "flexible" parameter resolution. The auth function
      resolves credentials via flexible fallback logic. Meanwhile, message retrieval only
      checks query parameters.


      Note that due to the nature of the endpoint, the business impact here is DoS not a regular
      data leak.
    http: null
    language: python
    parts:
    - part: 1
      file: e05_truthy_or/routes.py
      code_start_line: 34
      code_end_line: 50
    - part: 2
      file: e05_truthy_or/auth.py
      code_start_line: 8
      code_end_line: 15
    file_hashes:
      e05_truthy_or/auth.py: 6c37fd85dc2d993bdc171828d6031b7c0810a4b10ffa3a40c8dd07bb31ddd279
      e05_truthy_or/routes.py: b50020d4bf8bc3991747f97135666c0dd94168edc9f22191a0bb71fed5a38934
    fingerprint: 32b1dcbce8dd414ab64aa3443a8b5edeee32a5c1a9c114ebb473e293e648eff7
  6:
    id: 6
    kind: block
    title: null
    notes: null
    http: null
    language: python
    parts:
    - part: 2
      file: e06_dict_get_default/auth.py
      code_start_line: 8
      code_end_line: 16
    file_hashes:
      e06_dict_get_default/auth.py: f34471e6f747eece3d63cfb4686ad07e2a473cb76520a4db3d035bc789a8c148
    fingerprint: 3a95d894862c4c65f41f034053abe7ed725d8c9782f9d1050f768a971c7a45d0
  7:
    id: 7
    kind: block
    title: Flask's request.values Precedence Rules
    notes: >-
      This example is functionally equivalent to example 5, except here we use built-in `request.values`
      instead of writing our own source merging function.


      This version of `authenticate_user` relies on `request.form` and is secure on its own,
      but the vulnerability arises when `get_messages` uses `request.values` instead.
    http: null
    language: python
    parts:
    - part: 1
      file: e07_request_values/routes.py
      code_start_line: 20
      code_end_line: 34
    - part: 2
      file: e07_request_values/auth.py
      code_start_line: 10
      code_end_line: 16
    file_hashes:
      e07_request_values/auth.py: 6eb261ef832a2d5e89fe7778a7adbe0cafe7d59da0d3fbed6075ccced4f5d818
      e07_request_values/routes.py: ee52b0128eef375ac0817c482f63bca8a3efe543e6111a49a5c1afa18d6666e5
    fingerprint: 8b7bf008b46606a7cca35fd4ad72539bfcedca0523ad08105c91d7bf9eefa5e6
  8:
    id: 8
    kind: block
    title: Inconsistent request.values Adoption
    notes: >-
      Developers "fixed" the vulnerability in example 7, but introduced a NEW vulnerability
      when adding password update functionality.


      Updated authentication function uses `request.values` to verify WHO is making the request,
      but the target user whose password gets updated comes from `request.form` only.
    http: null
    language: python
    parts:
    - part: 1
      file: e08_inconsistent_adoption/routes.py
      code_start_line: 37
      code_end_line: 60
    - part: 2
      file: e08_inconsistent_adoption/auth.py
      code_start_line: 10
      code_end_line: 16
    file_hashes:
      e08_inconsistent_adoption/auth.py: 05691983635e81cbd7e1b7212fccbc014a7bf2fc40687309a0e554de8f9d6b3c
      e08_inconsistent_adoption/routes.py: 5de7cb86f5a9fbe4c0c53bfc3516749be4bed869943f4e4a2e7c5e4f5f1b5fef
    fingerprint: 5bab94babb73a83883256c1bc31fb5e7d393edbb9e842dbe8ba83d03bffa7ee2
attachments:
  http/exploit-1.http: 7713414ae250462e4ba2c8b096a7b7aa64fe151cb67a11bd1f215ed196b5d3b4
  http/exploit-2.http: 126e26ce2c04adaf7f91403fa8e79647a6675c050ef55181c60d8a3a27e90a24
  http/exploit-3.http: 12930529388dcc4af6265724b583469c071c5afb07795b9be52cd63d0d71a64f
  http/exploit-4.http: 0e76c3b1b2e1e11cb9a7166c8148a870962632f6e22473a58f2ac8407dc7eadd
  http/exploit-5.http: 4cc0dffe357b29c98f1752e7d45597394a2755b8a65f35132a54597aea7bcbc7
  http/exploit-6.http: 325a17126db3691dd744812fac2990835ebfaaa6189162fccd1d7095e023ea7b
  http/exploit-7.http: 1c9f40f3ec3cbd739269a7c511ca388bed906200fb99d40c6f701d48b0817604
  http/exploit-8.http: 38bf4588c8c2d26aecadc9763417f08dff1a7b9e9b669a4873717543dd0fc46e
build_signature: 3bc7a0a0428d367aafe77c4199a25e6ff41b34c4e33081cf1dd1e0c47d26d66a
last_readme_fingerprint: c6fcedced9b20f70e3a5b98368cbd62831f4ca3d1f024d2372ee6e5f9fa5ca53
