version: '1'
root: .
category: ii.source-precedence
namespace: flask-ii-source-precedence
examples:
  1:
    id: 1
    kind: function
    title: Secure Implementation
    notes: >-
      Here you can see a secure implementation that consistently uses form body parameters
      for both authentication and data retrieval.
    http: null
    language: python
    parts:
    - part: 1
      file: e00_intro/routes.py
      code_start_line: 32
      code_end_line: 45
    file_hashes:
      e00_intro/routes.py: d8a221f5b8e69740e8b5c1217729838fe22fecb63b3ab78e15a429cce76f82d2
    fingerprint: 1789819dbf85928947161bea2f0224e94a7813d92898fdcda2f2cd78ca872ab6
  2:
    id: 2
    kind: function
    title: Inline request.form vs request.args Confusion
    notes: >-
      Demonstrates the most basic form of parameter source confusion where authentication
      uses **form body** parameters but data retrieval uses **query string** parameters.


      An attacker authenticates with their own credentials in the body while specifying a
      victim's username in the URL.
    http: null
    language: python
    parts:
    - part: 1
      file: e00_intro/routes.py
      code_start_line: 58
      code_end_line: 69
    file_hashes:
      e00_intro/routes.py: d8a221f5b8e69740e8b5c1217729838fe22fecb63b3ab78e15a429cce76f82d2
    fingerprint: 992056bdcb8e1d9d492035f396df7f764fd86df1ee8e0eda32992f6c11b49850
  3:
    id: 3
    kind: block
    title: Function-Level Parameter Source Confusion
    notes: >-
      Separating authentication and data retrieval into different functions can make the vulnerability
      harder to spot.
    http: null
    language: python
    parts:
    - part: 1
      file: e00_intro/routes.py
      code_start_line: 79
      code_end_line: 105
    file_hashes:
      e00_intro/routes.py: d8a221f5b8e69740e8b5c1217729838fe22fecb63b3ab78e15a429cce76f82d2
    fingerprint: 3dfd585af17a29a3d373eaa06030fe07a2fe35495b3891c995f5955e96eb70d3
  4:
    id: 4
    kind: block
    title: Cross-Module Parameter Source Confusion
    notes: >-
      Confusion becomes even harder to detect when business logic splits across modules. The
      auth module uses form-based credentials (secure on its own) but doesn't match `messages_get`
      receiving a query string parameter.


      Each file looks reasonable in isolation—authentication in `auth.py` follows best practices,
      route handlers in `routes.py` use standard query parameters. The vulnerability lives
      at the boundary between modules, where reviewers rarely look.
    http: null
    language: python
    parts:
    - part: 1
      file: e04_cross_module/routes.py
      code_start_line: 22
      code_end_line: 33
    - part: 2
      file: e04_cross_module/auth.py
      code_start_line: 10
      code_end_line: 17
    - part: 3
      file: e04_cross_module/db.py
      code_start_line: 8
      code_end_line: 16
    file_hashes:
      e04_cross_module/auth.py: ed56680738f7fd5890c8f4d17712b49547527e8e1855362d899ef365368d8104
      e04_cross_module/db.py: 95ad040568f0be96b6acd1fc8b9164daf4be9d41fa55d8c4180704d40833234d
      e04_cross_module/routes.py: e7d02d321e0a5cfa93908e18d6d860133671572dbecfe5d87a1eb3a3d8cbe0e8
    fingerprint: ed5c453a59ad9f7fc6118d0235aadf8aa0f71cca571d1664f5431cb843112470
  5:
    id: 5
    kind: block
    title: Truthy-OR Parameter Precedence
    notes: >-
      Demonstrates a subtle vulnerability in "flexible" parameter resolution. The auth function
      resolves credentials via flexible fallback logic. Meanwhile, the message deletion function
      only checks the form parameters (the request body).


      The main function here is `_resolve`, which merges parameter sources with a specific
      priority: it first checks the URL query string (`request.args`) and only falls back
      to the request body (`request.form`) if the parameter is not in the URL. This allows
      an attacker to craft a request where the `user` parameter in the URL is their own (to
      pass authentication), while the `user` parameter in the body belongs to the victim (to
      target the action).


      This DELETE endpoint demonstrates message destruction rather than unauthorized reading—attackers
      can erase evidence or disrupt communications.
    http: null
    language: python
    parts:
    - part: 1
      file: e05_truthy_or/routes.py
      code_start_line: 41
      code_end_line: 57
    - part: 2
      file: e05_truthy_or/auth.py
      code_start_line: 8
      code_end_line: 15
    file_hashes:
      e05_truthy_or/auth.py: 1e7c93107b538bf855a4bf4bdd2b42b8ca7ccd6f2f1ef0467d254ac2dcff03a0
      e05_truthy_or/routes.py: 559d1216e6cc15ea3da63ac49cceeed764d24ff40e677baa2b71a54cb2ab310b
    fingerprint: a46655093be6e076beeb422f68c1a925e25a49b767c3647f2ad9e5c8dbea7008
  6:
    id: 6
    kind: block
    title: dict.get() Default Parameter Precedence
    notes: >-
      The vulnerability shown in example 5 was fixed by reversing priority of parameters in
      the merge function `_resolve`. However, this introduces a new vulnerability in the message
      retrieval function.


      Note that internet browsers and many web servers refuse body parameters for GET, however
      Flask does support them, opening an attack vector for the attacker.
    http: null
    language: python
    parts:
    - part: 1
      file: e06_dict_get_default/routes.py
      code_start_line: 21
      code_end_line: 31
    - part: 2
      file: e06_dict_get_default/auth.py
      code_start_line: 8
      code_end_line: 16
    file_hashes:
      e06_dict_get_default/auth.py: a6cec68115d392b7a6b02987683c8766abb5c295aae0279676ff9398f337adbd
      e06_dict_get_default/routes.py: 4acd116f026bd6a31d3e2f7acb1be7e0fd023d0b682c5020d05517851a763568
    fingerprint: edc1447f60303ddf0776d62ce7f91c52ebe6cc2ffe7ecb0dcb5cfdb10783bcd2
  7:
    id: 7
    kind: block
    title: Flask's request.values Precedence Rules
    notes: >-
      This example is functionally equivalent to example 5, except here we use built-in `request.values`
      instead of writing our own source merging function.


      Flask's `request.values` is a `CombinedMultiDict` merging `request.args` and `request.form`
      with **args taking precedence** when keys collide. This means `?user=attacker` in the
      URL overrides `user=victim` in the POST body.


      This version of `authenticate_user` relies on `request.form` and is secure on its own,
      but the vulnerability arises when `get_messages` uses `request.values` instead.
    http: null
    language: python
    parts:
    - part: 1
      file: e07_request_values/routes.py
      code_start_line: 24
      code_end_line: 38
    - part: 2
      file: e07_request_values/auth.py
      code_start_line: 10
      code_end_line: 16
    file_hashes:
      e07_request_values/auth.py: 09df0b1d50421652e90fdd1467df50d27b411cd3e76443cfcc618a9b999c723e
      e07_request_values/routes.py: 4026ff4fef91df006afba27ca4ddd4eaa5c28de2b959bdd70e503c5ea05ef049
    fingerprint: d19dc5ca4b6fbdc3ef8d9e18a58cd31b1fc99989b951d87e966baab8cb90b921
  8:
    id: 8
    kind: block
    title: Inconsistent request.values Adoption
    notes: >-
      Developers "fixed" the vulnerability in example 7, but introduced a NEW vulnerability
      when adding password update functionality.


      Updated authentication function uses `request.values` to verify WHO is making the request,
      but the target user whose password gets updated comes from `request.form` only.
    http: null
    language: python
    parts:
    - part: 1
      file: e08_inconsistent_adoption/routes.py
      code_start_line: 37
      code_end_line: 60
    - part: 2
      file: e08_inconsistent_adoption/auth.py
      code_start_line: 10
      code_end_line: 16
    file_hashes:
      e08_inconsistent_adoption/auth.py: 5641434466a13d37a31b84f1eed363a32999082146b9d17d047a9a17d06eea4e
      e08_inconsistent_adoption/routes.py: 5dde8f21ff6a40138fb3811efb374733ce36de9dde1d6318b56e2eac8b9223b6
    fingerprint: b47ba7a1b1926126488b450486f52d13b083e8ad1ab5392c24f8de824f2df341
attachments:
  http/exploit-1.http: 596740771173ce933d3723fba015395ee3d4eaad80f44406956892fda7424e90
  http/exploit-2.http: 9b866468810c6a0fa73ed4a7e5b56479275bc2cb68d18316408ed1c661e9e427
  http/exploit-3.http: cfb8afceb952d682871fcff88bd4c187920af352392fd8e528268dcd4458fbe7
  http/exploit-4.http: b656bbb24e0745b2941cb45925de02525c6391b129b221513c966433d6efed85
  http/exploit-5.http: fb4f2983b2c0e66f1cc0eb473f0285c15f1e78488b0f091415cd9a806a13ab93
  http/exploit-6.http: c59f74a20725d975cfe7092728c3b3912737131496af1e0174a9157660150745
  http/exploit-7.http: ec8b73ce6c41d2aa703acb19b053235dba8bf1af60e5508e63c8a392c3053ea9
  http/exploit-8.http: fc2acc168b3adda8231fd329f0f9285ddfbc7763a374559139e8f683b37d754b
build_signature: 39aabfc4f3a1a6ecb0a2959ecfdecd80199116140db0977d0663bc88b8e497da
last_readme_fingerprint: 96826e243c154a9e3738b75b75a28809ab33c4064a5d11d2beab6a69fa88fe0d
