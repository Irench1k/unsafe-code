version: '1'
root: .
category: ii.source-precedence
namespace: flask-ii-source-precedence
examples:
  1:
    id: 1
    kind: function
    title: Secure Implementation
    notes: >-
      Here you can see a secure implementation that consistently uses form body parameters
      for both authentication and data retrieval.
    http: null
    language: python
    parts:
    - part: 1
      file: e00_intro/routes.py
      code_start_line: 32
      code_end_line: 45
    file_hashes:
      e00_intro/routes.py: ea22426fa890d53e70e9df2e8d2977af6aa0b7ad3d6f991618073067cd39c7e2
    fingerprint: 8b7119721854fd64c30c7b757c561c1f2cbdeefd3aeda75f8d23b100a21bc1a4
  2:
    id: 2
    kind: function
    title: Inline request.form vs request.args Confusion
    notes: >-
      Demonstrates the most basic form of parameter source confusion where authentication
      uses **form body** parameters but data retrieval uses **query string** parameters.


      An attacker authenticates with their own credentials in the body while specifying a
      victim's username in the URL.
    http: null
    language: python
    parts:
    - part: 1
      file: e00_intro/routes.py
      code_start_line: 58
      code_end_line: 69
    file_hashes:
      e00_intro/routes.py: ea22426fa890d53e70e9df2e8d2977af6aa0b7ad3d6f991618073067cd39c7e2
    fingerprint: 4a2d614a98423bc71ee384965e7f3d085b6870ee245dc75d9eb3356db889d9a8
  3:
    id: 3
    kind: block
    title: Function-Level Parameter Source Confusion
    notes: >-
      Separating authentication and data retrieval into different functions can make the vulnerability
      harder to spot.
    http: null
    language: python
    parts:
    - part: 1
      file: e00_intro/routes.py
      code_start_line: 79
      code_end_line: 105
    file_hashes:
      e00_intro/routes.py: ea22426fa890d53e70e9df2e8d2977af6aa0b7ad3d6f991618073067cd39c7e2
    fingerprint: c4e4fa83bf3e7f86c67295e7ab808298a90d0bc1426132684e0a03202f5ddfc3
  4:
    id: 4
    kind: block
    title: Cross-Module Parameter Source Confusion
    notes: >-
      Confusion becomes even harder to detect when business logic splits across modules. The
      auth module uses form-based credentials (secure on its own) but doesn't match `messages_get`
      receiving a query string parameter.


      Each file looks reasonable in isolation—authentication in `auth.py` follows best practices,
      route handlers in `routes.py` use standard query parameters. The vulnerability lives
      at the boundary between modules, where reviewers rarely look.
    http: null
    language: python
    parts:
    - part: 1
      file: e04_cross_module/routes.py
      code_start_line: 22
      code_end_line: 33
    - part: 2
      file: e04_cross_module/auth.py
      code_start_line: 10
      code_end_line: 17
    - part: 3
      file: e04_cross_module/db.py
      code_start_line: 8
      code_end_line: 16
    file_hashes:
      e04_cross_module/auth.py: 67d483a100c41992ab94bf5e5361b61df5e56fbc865d942857c624ebcd219505
      e04_cross_module/db.py: 11d44dbeda8a5b978bd18daeb182b4d69ccc843e118572dc51936850d8fbc375
      e04_cross_module/routes.py: 6790b1dd4344850f05539b5cb22df3c647f37a886d27b3b695b4dea19ba35c81
    fingerprint: 187c5b72565b1c4fb95435918303558997fa3ff1f01125b1f1c45689276ae863
  5:
    id: 5
    kind: block
    title: Truthy-OR Parameter Precedence
    notes: >-
      Demonstrates a subtle vulnerability in "flexible" parameter resolution. The auth function
      resolves credentials via flexible fallback logic. Meanwhile, the message deletion function
      only checks the form parameters (the request body).


      The main function here is `_resolve`, which merges parameter sources with a specific
      priority: it first checks the URL query string (`request.args`) and only falls back
      to the request body (`request.form`) if the parameter is not in the URL. This allows
      an attacker to craft a request where the `user` parameter in the URL is their own (to
      pass authentication), while the `user` parameter in the body belongs to the victim (to
      target the action).


      This DELETE endpoint demonstrates message destruction rather than unauthorized reading—attackers
      can erase evidence or disrupt communications.
    http: null
    language: python
    parts:
    - part: 1
      file: e05_truthy_or/routes.py
      code_start_line: 41
      code_end_line: 57
    - part: 2
      file: e05_truthy_or/auth.py
      code_start_line: 8
      code_end_line: 15
    file_hashes:
      e05_truthy_or/auth.py: 6c37fd85dc2d993bdc171828d6031b7c0810a4b10ffa3a40c8dd07bb31ddd279
      e05_truthy_or/routes.py: 429dc321b7ee2f58585fec1f6876958aee4a8f3808cacf7292ff3fb302b4072c
    fingerprint: 805715c3e5aefc64df2dd0565c375710f8903a74fe9942995c4123fcf422f517
  6:
    id: 6
    kind: block
    title: dict.get() Default Parameter Precedence
    notes: >-
      The vulnerability shown in example 5 was fixed by reversing priority of parameters in
      the merge function `_resolve`. However, this introduces a new vulnerability in the message
      retrieval function.


      Note that internet browsers and many web servers refuse body parameters for GET, however
      Flask does support them, opening an attack vector for the attacker.
    http: null
    language: python
    parts:
    - part: 1
      file: e06_dict_get_default/routes.py
      code_start_line: 21
      code_end_line: 31
    - part: 2
      file: e06_dict_get_default/auth.py
      code_start_line: 8
      code_end_line: 16
    file_hashes:
      e06_dict_get_default/auth.py: 71c24b46dc6d6d7d7bcd7892c8d635e9ea783192ecfe049d6bb8740d55ec4800
      e06_dict_get_default/routes.py: 154442e971146863eaaa0cb18bb711aa1f409cb32827e01569a83b65562cd357
    fingerprint: ef9410e71aa758a8ebab57e89effef467b69b08ae354e376a32468f5980d5685
  7:
    id: 7
    kind: block
    title: Flask's request.values Precedence Rules
    notes: >-
      This example is functionally equivalent to example 5, except here we use built-in `request.values`
      instead of writing our own source merging function.


      Flask's `request.values` is a `CombinedMultiDict` merging `request.args` and `request.form`
      with **args taking precedence** when keys collide. This means `?user=attacker` in the
      URL overrides `user=victim` in the POST body.


      This version of `authenticate_user` relies on `request.form` and is secure on its own,
      but the vulnerability arises when `get_messages` uses `request.values` instead.
    http: null
    language: python
    parts:
    - part: 1
      file: e07_request_values/routes.py
      code_start_line: 24
      code_end_line: 38
    - part: 2
      file: e07_request_values/auth.py
      code_start_line: 10
      code_end_line: 16
    file_hashes:
      e07_request_values/auth.py: 8c65942b4895f65f7c62ca62fee946f310128eb8ddb0322c300e6d3d0cd39d51
      e07_request_values/routes.py: 648d5b297580a5a45681d2e63409002fd2f1d13577fb6cc38ea45989fcda9c59
    fingerprint: 064fc60338049755dc3c75f7cb946a7946940e56ceb8f870cb3c3b5932e7bd1f
  8:
    id: 8
    kind: block
    title: Inconsistent request.values Adoption
    notes: >-
      Developers "fixed" the vulnerability in example 7, but introduced a NEW vulnerability
      when adding password update functionality.


      Updated authentication function uses `request.values` to verify WHO is making the request,
      but the target user whose password gets updated comes from `request.form` only.
    http: null
    language: python
    parts:
    - part: 1
      file: e08_inconsistent_adoption/routes.py
      code_start_line: 37
      code_end_line: 60
    - part: 2
      file: e08_inconsistent_adoption/auth.py
      code_start_line: 10
      code_end_line: 16
    file_hashes:
      e08_inconsistent_adoption/auth.py: e3481a68a0bc6c75d58ce5340e575386e2141a1ebe9b1a1dce7fc050dd60e814
      e08_inconsistent_adoption/routes.py: 5de7cb86f5a9fbe4c0c53bfc3516749be4bed869943f4e4a2e7c5e4f5f1b5fef
    fingerprint: 8aac683efa85ece8031e044b228151e79277959c351f202c45be08ae9220a37c
attachments:
  http/exploit-1.http: 7713414ae250462e4ba2c8b096a7b7aa64fe151cb67a11bd1f215ed196b5d3b4
  http/exploit-2.http: a2e08b708653bbc122f333685c4a4253bf3dcc6f96518d8e6a3fad11be3f0aef
  http/exploit-3.http: 12930529388dcc4af6265724b583469c071c5afb07795b9be52cd63d0d71a64f
  http/exploit-4.http: e7393cec959dd3dbb38db3d77c18f30dd079bf8b4b80134162fc3bffc92282ab
  http/exploit-5.http: 01f80a0f20c23be559b174885b0965f6171a51c303e69a05a3983c6ab50a8a92
  http/exploit-6.http: 325a17126db3691dd744812fac2990835ebfaaa6189162fccd1d7095e023ea7b
  http/exploit-7.http: 1c9f40f3ec3cbd739269a7c511ca388bed906200fb99d40c6f701d48b0817604
  http/exploit-8.http: d6138633790a593621dfa4956156ea09a044f288b037a7a17b229139f5a23348
build_signature: 8643ffcaea29e8ab29177eb7149a28ebe542c07ad8feceed7ba3edbbcd48a1b7
last_readme_fingerprint: f7cffa191a1a2a72210eb1681078cabf50b58440aff7816b46fc2f4ab39fa6bb
