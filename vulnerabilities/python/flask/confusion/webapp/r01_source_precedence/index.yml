version: '1'
root: .
category: ii.source-precedence
namespace: flask-ii-source-precedence
examples:
  1:
    id: 1
    kind: function
    title: Secure Implementation
    notes: >-
      Here you can see a secure implementation that consistently uses query string parameters
      for both authentication and data retrieval.
    http: open
    language: python
    parts:
    - part: 1
      file: e0103_intro/routes.py
      code_start_line: 33
      code_end_line: 51
    file_hashes:
      e0103_intro/routes.py: 0c79b1b3b6a3cd05cab7511b401d31430d94421fdc6b0c261fd2f83e03ebc3fa
    fingerprint: 8cf16c2d3e2e200c825f69a1b659d0c00bfaa62a91914b31d3526c02cd9ab089
  2:
    id: 2
    kind: function
    title: Basic Parameter Source Confusion
    notes: >-
      Demonstrates the most basic form of parameter source confusion where authentication
      uses **query** parameters but data retrieval uses **form** data.


      We take the user name from the query string during the validation, but during the data
      retrieval another value is used, taken from the request body (form). This does not look
      very realistic, but it demonstrates the core of the vulnerability, we will build upon
      this further.


      Here you can see if we provide squidward's name in the request body, we can access his
      messages without his password.
    http: null
    language: python
    parts:
    - part: 1
      file: e0103_intro/routes.py
      code_start_line: 68
      code_end_line: 87
    file_hashes:
      e0103_intro/routes.py: 0c79b1b3b6a3cd05cab7511b401d31430d94421fdc6b0c261fd2f83e03ebc3fa
    fingerprint: 8dfc5d0228b2122282ab60ada964fdb824a1325ad311c560ce948ea98e7cb3f4
  3:
    id: 3
    kind: block
    title: Function-Level Parameter Source Confusion
    notes: >-
      Functionally equivalent to example 2, but shows how separating authentication and data
      retrieval into different functions can make the vulnerability harder to spot.
    http: open
    language: python
    parts:
    - part: 1
      file: e0103_intro/routes.py
      code_start_line: 97
      code_end_line: 126
    file_hashes:
      e0103_intro/routes.py: 0c79b1b3b6a3cd05cab7511b401d31430d94421fdc6b0c261fd2f83e03ebc3fa
    fingerprint: d32f522671f640b75bd6dc2866d18abc95aaa0448241e9c9885de15edd245a92
  4:
    id: 4
    kind: block
    title: Cross-Module Parameter Source Confusion
    notes: >-
      In the previous example, you can still see that the `user` value gets retrieved from
      the `request.args` during validation but from the `request.form` during data retrieval.


      A more subtle example, where this is not immediately obvious (imagine, `authenticate_user`
      is defined in an another file altogether):
    http: null
    language: python
    parts:
    - part: 1
      file: e04_cross_module/db.py
      code_start_line: 15
      code_end_line: 25
    - part: 2
      file: e04_cross_module/auth.py
      code_start_line: 10
      code_end_line: 18
    - part: 3
      file: e04_cross_module/routes.py
      code_start_line: 13
      code_end_line: 28
    file_hashes:
      e04_cross_module/auth.py: b54256b7e1d701b54d0f53f24f7064fa29bcb103f86f6569c7b8c3b6557fefe5
      e04_cross_module/db.py: 5f9857b885fbbfb80885f6bb127ab6975d0415732da2d4eb63ff936f46ee8780
      e04_cross_module/routes.py: d003a8f1fb5e54484ad1c3810c564c494282789c0f635f7801772e4e3df452ef
    fingerprint: 6a7319bda92e01b3f2da5929adc34fe37a107ce3d0e033f74df4e8da09e4a559
  5:
    id: 5
    kind: block
    title: Mixed-Source Authentication
    notes: >-
      Shows how authentication and data access can use different combinations of sources.


      This one is interesting, because you can access Squidward's messages by providing his
      username and SpongeBob's password in the request query, while providing SpongeBob's
      username in the request body:
    http: null
    language: python
    parts:
    - part: 1
      file: e05_mixed_source/auth.py
      code_start_line: 12
      code_end_line: 33
    file_hashes:
      e05_mixed_source/auth.py: c4f927876d95b95d5d28e557c8cb0d9634e629d848a711b6fa2ba29daaa6149f
    fingerprint: d393be71849109a9db0d6eb90b5a432fe0b8e573ce51301381a8e1bd5d677d2b
  6:
    id: 6
    kind: function
    title: Destructive Parameter Source Confusion
    notes: >-
      Demonstrates parameter source confusion with a DELETE operation. Same root cause as
      Examples 2-5, but now enabling destructive operations instead of just data disclosure.
      Authentication uses query parameters while deletion target uses form body.
    http: null
    language: python
    parts:
    - part: 1
      file: e06_destructive/routes.py
      code_start_line: 17
      code_end_line: 39
    file_hashes:
      e06_destructive/routes.py: 8b47497c5168de82610466a29674ba9fd28a957c9f0193408d504e805eaa085f
    fingerprint: 6a1067143c511c743a49ad2964d5bd13c4ae124ed00f5b239dd1354b3c58ee6e
  7:
    id: 7
    kind: block
    title: Form Authentication Bypass
    notes: >-
      The endpoint uses form data for authentication, but request.values.get() allows query
      parameters to override form values, creating a vulnerability. Although designed for
      POST requests, the endpoint accepts both GET and POST methods, enabling the attack.


      Note that although the regular usage would rely on POST request (or PUT, PATCH, etc.),
      and wouldn't work with GET (because flask's request.values ignores form data in GET
      requests), the attacker can send both GET and POST requests (if the endpoint is configured
      to accept both methods).


      ```http

      POST /ii/source-precedence/example7? HTTP/1.1

      Content-Type: application/x-www-form-urlencoded

      Content-Length: 35


      user=spongebob&password=bikinibottom

      ```


      However, the attacker can send both GET and POST requests (if the endpoint is configured
      to accept both methods).
    http: null
    language: python
    parts:
    - part: 1
      file: e07_form_bypass/auth.py
      code_start_line: 24
      code_end_line: 32
    file_hashes:
      e07_form_bypass/auth.py: 5f4097160d44fd557e4a68d133c1ec23ed509af822856ed59f63186b8f5fbd1d
    fingerprint: ab53946b5c4632dc6d5699088f3b4940a28ca691308737950f3e437215a0f410
  8:
    id: 8
    kind: function
    title: Password Reset Parameter Confusion
    notes: >-
      Developers "fixed" the messages endpoint but introduced a NEW vulnerability when adding
      password reset functionality. Authentication uses request.values to verify WHO is making
      the request, but the target user whose password gets reset comes from request.form only.


      An attacker can authenticate with their own credentials in the query string while specifying
      a victim's username in the form body, resetting the victim's password to one they control.
      This enables full account takeover.


      LESSON: This demonstrates how "apparent fixes" create false security. Same root cause
      as Examples 2-7, but now enabling account takeover instead of just data disclosure.
      The partial fix made developers careless when adding new features.
    http: null
    language: python
    parts:
    - part: 1
      file: e08_password_reset/routes.py
      code_start_line: 47
      code_end_line: 64
    file_hashes:
      e08_password_reset/routes.py: fbb7b2ff727fea6d3ea8441d30a094ae47275f9ea56ee6c41aa2e120eb208577
    fingerprint: 9da6b117fc5f4b4f71b1c9dffca914ccb72a45673ebe7047dd03c9df1928ea56
attachments:
  http/exploit-1.http: 50f85726ba27321f7a75e2f075a6ce5e73cd554912c8941c3f9809d438e71eaa
  http/exploit-2.http: e2811e1f074cdb4b8589caaf500af2f6ea10ba93468c2e92b231666ebbd8670b
  http/exploit-3.http: 885d1ed34ceafe5645ea80d29585573774a7dc8f0a0ec58fd0503e81de6bf477
  http/exploit-4.http: 6369d3570fb27203bbe27ab575d18863d59a2990d6ae91c2e2982bdeb132dd71
  http/exploit-5.http: 92472e91599a6a64344a05858e3eadbc2363e252dea8f8bfff834b69e46b0575
  http/exploit-6.http: 28d7fc50dac6a7971985cd333b17ef5bb17f86231e2bc82fbb68877dc237326b
  http/exploit-7.http: b6e8d399cd54bfe799c03c6ecd8ae4fc9231786135a4488c805515d8ebf876c0
  http/exploit-8.http: 7108a192427244ee45ed2c0854e3d44e9f659a4f2780b519621cbb139599342b
build_signature: 85f94d229b8933d3e6f6f3fd708b02e5020abd20118fec301a2558f5a5362960
last_readme_fingerprint: 08e59dd71fd938bc6a817225c0f162bca4ea21344d1c6fa8837c4c5257ba470d
