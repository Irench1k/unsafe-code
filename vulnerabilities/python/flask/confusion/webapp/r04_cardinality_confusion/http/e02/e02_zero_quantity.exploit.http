# @import ../common/setup.http
@host = {{base_host}}/v402

### Setup
# @name seed
{{
  await seedBalance("v402", "plankton@chum-bucket.sea", 100);
}}
GET /menu

@krabby_patty = {{response.parsedBody.find(i => i.name == "Krabby Patty")}}
@fries = {{response.parsedBody.find(i => i.name.includes("Fries"))}}

# ===== Free Fries and Krabby Patty =====

### Plankton creates a new cart
# @name new_cart
# @ref seed
POST /cart?restaurant_id=1
Authorization: {{plankton_auth}}

@cart_id = {{response.parsedBody.cart_id}}


### Add 0 Krabby Patties to the cart
# @name cart_with_zero_patties
# @ref new_cart
POST /cart/{{cart_id}}/items
Authorization: {{plankton_auth}}
Content-Type: application/json

{ "item_id": {{krabby_patty.id}}, "quantity": 0 }

### Add 0 Fries to the cart
# @name cart_with_zero_fries
# @ref cart_with_zero_patties
POST /cart/{{cart_id}}/items
Authorization: {{plankton_auth}}
Content-Type: application/json

{ "item_id": {{fries.id}}, "quantity": 0 }


### Checkout the cart, with Krabby Patty and Fries - only paying the delivery fee!
# @name checkout_cart
# @ref cart_with_zero_fries
POST /cart/{{cart_id}}/checkout
Authorization: {{plankton_auth}}
Content-Type: application/json

{
  "tip": "0",
  "delivery_address": "Chum Bucket"
}

?? js response.parsedBody.items.length == 2
?? js response.parsedBody.total == 5.00

{{
  const itemNames = response.parsedBody.items.map(i => i.name).join(" + ");
  console.info("ðŸ’° Plankton got " + itemNames + " for only $" + response.parsedBody.total + " (delivery fee only - items were FREE)!");
}}
