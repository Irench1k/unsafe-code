version: '1'
root: .
category: policy-composition-and-precedence.merge-order-and-short-circuit
namespace: flask-policy-merge-order
examples:
  1:
    id: 1
    kind: block
    title: Authorization Bypass via Decorator Execution Order
    notes: >-
      We try to fix the root cause of the vulnerability here by enforcing correct merging
      order – view args take precedence over query args. Additionally, we enforce that only
      one of the two can be present.


      The code, however, remains vulnerable despite these efforts! This time, the problem
      is that the `@check_group_membership_v2` decorator is applied too early – before the
      `@basic_auth_v3` decorator which is responsible for setting the `g.group` global variable.
      This makes `@check_group_membership_v2` a no-op.


      This is a pure policy composition issue: the guard decorator executes before the authentication
      decorator prepares the state it depends on. Flask applies decorators bottom-up (outer
      decorator runs first), so @check_group_membership_v2 sees g.group = None and passes
      all requests.
    http: null
    language: python
    parts:
    - part: 1
      file: routes.py
      code_start_line: 25
      code_end_line: 30
    - part: 2
      file: decorator.py
      code_start_line: 15
      code_end_line: 46
    file_hashes:
      decorator.py: a6e9bb78e6d207474240f1e739178d5e57ecb62d4e30a4c69807f437856808ad
      routes.py: 15707bd05835f8faebba08b0d26b4db8e385d11a8f0c698318fbcdc6a613002b
    fingerprint: 5cf34c2d50dba3fc3fd4dc4396e6e315010aa4c7ff27e138c394c5553c6b2e25
attachments:
  http/exploit-1.http: 0266126446530f7149bee2f6a5bfc70666adcaf87485d886c82bbb60f9794b60
build_signature: 54a8a1b79938affc38845633365b36f2157d2512e8101893d177653748a3bbe0
last_readme_fingerprint: 18e90c940675202e7cb83cbdb55a9f6184f1078b15609dafa61e93155cce90ab
