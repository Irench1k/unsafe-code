version: '1'
root: .
category: policy-composition-and-precedence.merge-order-and-short-circuit
namespace: flask-policy-merge-order
examples:
  1:
    id: 1
    kind: block
    title: Authorization Bypass via Decorator Execution Order
    notes: >-
      We try to fix the root cause of the vulnerability here by enforcing correct merging
      order – view args take precedence over query args. Additionally, we enforce that only
      one of the two can be present.


      The code, however, remains vulnerable despite these efforts! This time, the problem
      is that the `@check_group_membership_v2` decorator is applied too early – before the
      `@basic_auth_v3` decorator which is responsible for setting the `g.group` global variable.
      This makes `@check_group_membership_v2` a no-op.


      This is a pure policy composition issue: the guard decorator executes before the authentication
      decorator prepares the state it depends on. Flask applies decorators bottom-up (outer
      decorator runs first), so @check_group_membership_v2 sees g.group = None and passes
      all requests.
    http: null
    language: python
    parts:
    - part: 1
      file: routes.py
      code_start_line: 25
      code_end_line: 30
    - part: 2
      file: decorator.py
      code_start_line: 15
      code_end_line: 46
    file_hashes:
      decorator.py: 16a9c5082f5629c2778e37174c3d66acb8913400470a690475a48f219f31285f
      routes.py: 28e58bc1880ebb622f0ce2cea4e7ec59405298c35727c421107314deae7ebc15
    fingerprint: 4ca3fcb0b0fe2892b866f392000520d448436d7d37fbb3e8262507ce7da11ee0
attachments:
  http/exploit-1.http: bd77f8781408ec4167630b88215c9e4bbc483e268838101d62aa5ad5f6724fbb
build_signature: 9f0d37c596a5d6a6206d72fd11e2c175b1a8e51929b17a81dbc168b6d7eec169
last_readme_fingerprint: c557c6b2dd23c4e9bd4b3865f29b5e9cdd42222585d782d9b90da019e08256b5
