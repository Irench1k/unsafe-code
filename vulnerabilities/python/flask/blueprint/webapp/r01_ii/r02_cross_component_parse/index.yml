version: '1'
root: .
category: ii.cross-component-parse
namespace: flask-ii-cross-component-parse
examples:
  1:
    id: 1
    kind: block
    title: Consistent Parameter Sourcing [Not Vulnerable]
    notes: >-
      This baseline demonstrates the secure pattern for handling authentication when decorators
      and handlers need to access the same user identity.


      THE SECURE PATTERN: Consistent parameter sourcing across all layers.

      - Authentication decorator validates credentials from request.args

      - Handler retrieves user identity from the SAME source (request.args)

      - Both layers use identical logic: request.args.get("user")

      - Result: Authentication and data access work on the same identity


      This prevents authentication bypass by ensuring that the identity validated during authentication
      is the exact same identity used for data access. There is no confusion between different
      request data sources.


      Compare this to the vulnerable examples that follow, where different layers source the
      user identity from different request properties, creating authentication bypass vulnerabilities.
    http: null
    language: python
    parts:
    - part: 1
      file: r01_baseline/routes.py
      code_start_line: 28
      code_end_line: 41
    - part: 2
      file: r01_baseline/decorator.py
      code_start_line: 9
      code_end_line: 26
    file_hashes:
      r01_baseline/decorator.py: 3351dc3ce99d5430d79ff87aac7851c9682675da2c7816f326b7eea0e274caab
      r01_baseline/routes.py: c6a4f807eac665058e67eddcf04f380fd17c3717ce72cf73d002847a799b45a5
    fingerprint: 62504fe09de2bd5c8467271af12b55b14fd03469aebc37aaa01027b124b1ae22
  2:
    id: 2
    kind: block
    title: Decorator-based Authentication with Parsing Drift
    notes: >-
      Shows how using decorators can obscure parameter source confusion, leading to authentication
      bypass.


      Example 2 is functionally equivalent to Example 4 from the source precedence examples,
      but it may be harder to spot the vulnerability when using decorators because the parameter
      source logic is split across multiple layers.


      THE VULNERABILITY: Authentication bypass via source precedence confusion.

      - Authentication decorator validates credentials from request.args (query string)

      - Handler retrieves user identity from get_user_ex2(), which prioritizes request.form

      - Attack: Provide SpongeBob's credentials in query string, Squidward's name in form
      body

      - Result: Authenticate as SpongeBob, but access Squidward's messages


      This is NOT authorization binding drift - it's authentication bypass because the authenticated
      identity itself gets confused between authentication check and data access.
    http: null
    language: python
    parts:
    - part: 1
      file: r02_decorator_drift/routes.py
      code_start_line: 28
      code_end_line: 34
    - part: 2
      file: r02_decorator_drift/decorator.py
      code_start_line: 9
      code_end_line: 23
    file_hashes:
      r02_decorator_drift/decorator.py: 21a90057887ec40d0fbacde26110d5f9f796399ddd8c30cb12bcb8c41e150a2f
      r02_decorator_drift/routes.py: 79a8960009f60d49b07decedfcc7ec2a70b872ff344b12b76e9a168fdd665760
    fingerprint: 83f184011ab24961f94b9d68e0332f47533ce22c258b74ff8783ce5f9e3bf570
  3:
    id: 3
    kind: block
    title: Middleware-based Authentication with Parsing Drift
    notes: >-
      Demonstrates how Flask's middleware system can contribute to parameter source confusion.


      Example 3 is functionally equivalent to Example 4 from the old parameter source confusion
      examples, but it may be harder to spot the vulnerability while using middleware.


      The before_request middleware authenticates using request.args.get("user"), but the
      handler retrieves the user via get_user(request) which prioritizes request.form over
      request.args. This allows an attacker to authenticate as SpongeBob but access Squidward's
      messages.
    http: null
    language: python
    parts:
    - part: 1
      file: r03_middleware_drift/routes.py
      code_start_line: 22
      code_end_line: 27
    - part: 2
      file: r03_middleware_drift/middleware.py
      code_start_line: 9
      code_end_line: 22
    file_hashes:
      r03_middleware_drift/middleware.py: e426011539f8710630f460fdcf1c5778b68a4ad7e4ca4c159f9831240f814f6c
      r03_middleware_drift/routes.py: aed01c24c03a314dfd53aa1e2a622bffc1cfaebd5818a0f1ebf7edfa70602cad
    fingerprint: 243c309ecebdd3c45597a90df4fe3a4a337796f3be9c57d5b940152452794833
attachments:
  http/exploit-1.http: 3d79c1ba3b691c62c0f1dc6961dc6732da910996c0b06d07d8d3e415fd910557
  http/exploit-2.http: 7400c5be3a7dd66c7bdd1330e60f7b18d109508ba1c3a7c1ec0bc50d8d9db620
  http/exploit-3.http: be70214e060b832ae8a69fa0ff5a57fe24b9649b87fcaa6a82ccb0f5776066e6
build_signature: e5ac941638605e69a15aafc12da24a61d954cdff02ea5becffb18ac0ea144c27
last_readme_fingerprint: e01c82219d5058756172fba5c40a5d7eddc1d9a776b348e4327c4d33b274eb9c
