version: '1'
root: .
category: ii.cross-component-parse
namespace: flask-ii-cross-component-parse
examples:
  8:
    id: 8
    kind: block
    title: Decorator-based Authentication with Parsing Drift
    notes: >-
      Shows how using decorators can obscure parameter source confusion, leading to authentication
      bypass.


      Example 8 is functionally equivalent to Example 4 from the source precedence examples,
      but it may be harder to spot the vulnerability when using decorators because the parameter
      source logic is split across multiple layers.


      THE VULNERABILITY: Authentication bypass via source precedence confusion.

      - Authentication decorator validates credentials from request.args (query string)

      - Handler retrieves user identity from get_user_ex8(), which prioritizes request.form

      - Attack: Provide Alice's credentials in query string, Bob's name in form body

      - Result: Authenticate as Alice, but access Bob's messages


      This is NOT authorization binding drift - it's authentication bypass because the authenticated
      identity itself gets confused between authentication check and data access.
    http: null
    language: python
    parts:
    - part: 1
      file: r02_decorator_drift/routes.py
      code_start_line: 28
      code_end_line: 34
    - part: 2
      file: r02_decorator_drift/decorator.py
      code_start_line: 9
      code_end_line: 23
    file_hashes:
      r02_decorator_drift/decorator.py: ff55e702086945517e9b98782453610fdbd3e66759fe17dba3eacc197d67af3e
      r02_decorator_drift/routes.py: e9bf0a6a26bb1c4f5884a3bd0bdf2ecc3815fa868633430e37989988fb09a9f4
    fingerprint: fbf2a7c864b89e78dba9bf9e2b2b1eec3e0c8ec82399b6f94983bf7f390369fb
  9:
    id: 9
    kind: block
    title: Middleware-based Authentication with Parsing Drift
    notes: >-
      Demonstrates how Flask's middleware system can contribute to parameter source confusion.


      Example 9 is functionally equivalent to Example 4 from the old parameter source confusion
      examples, but it may be harder to spot the vulnerability while using middleware.


      The before_request middleware authenticates using request.args.get("user"), but the
      handler retrieves the user via get_user(request) which prioritizes request.form over
      request.args. This allows an attacker to authenticate as Alice but access Bob's messages.
    http: null
    language: python
    parts:
    - part: 1
      file: r03_middleware_drift/routes.py
      code_start_line: 22
      code_end_line: 27
    - part: 2
      file: r03_middleware_drift/middleware.py
      code_start_line: 9
      code_end_line: 22
    file_hashes:
      r03_middleware_drift/middleware.py: 7be8f54cda7ee73c500580ef9b605340802d6bfcdca640d15a4c00e95ef50c11
      r03_middleware_drift/routes.py: 99d0558951828b7f9ce2894752b55e35606c73920f3cfde5bda83a4fec1934f3
    fingerprint: 9cb66884c99b44cd43726316c6518fd1a894454c56e5948d47d98a43fe4aeedd
  13:
    id: 13
    kind: block
    title: Shared Contract Baseline [Not Vulnerable]
    notes: >-
      We move to authorization rather than authentication vulnerabilities, so for the following
      examples the authentication will be done reliably and safely, via the `Authorization`
      header (based on Basic Auth and handled in the `@basic_auth_v1` decorator). We also
      follow the best practices by storing the authenticated user in the global context (`g.user`).


      Imagine that at this point we have many `/groups/` and `/user/` endpoints for creating,
      updating and deleting groups, users and messages.


      When the endpoint needs to work with a specific group, this could be passed as a query/form
      argument as in the previous examples, but if the `group` argument is required, it might
      be more idiomatic to make it a path parameter instead.


      Here we will work with two endpoints, the `/groups/<group>/messages` which will return
      the messages from a specific group (taking the `group` from the path) and the `/user/messages`
      which will return the user's private messages by default, but also supporting an optional
      `group` query argument.
    http: null
    language: python
    parts:
    - part: 1
      file: r01_baseline/routes.py
      code_start_line: 31
      code_end_line: 57
    - part: 2
      file: r01_baseline/decorator.py
      code_start_line: 15
      code_end_line: 28
    file_hashes:
      r01_baseline/decorator.py: 5e07e4bafb8fdb2db0445812fc93687ba0688c956389cba3a18aafb8cb73b3c3
      r01_baseline/routes.py: 5fab6fc5c1161d08af87cf4cbac2609dda6e4913552c67fbd26c592b5bb19794
    fingerprint: 48fbea82a28e446b9ea5907423a132ce62d840d61932ec8419a1326a0482ad24
attachments:
  http/exploit-13.http: ca171f22412131fdbc7c6415bc442588203ce656b02f9a4166de15936ce635e8
  http/exploit-14.http: 857966815992cd56bec25e836b622be2c4cbfe1a568307f951dbae57ab670d1e
  http/exploit-15.http: 3174bd27bdac5c8bdac2cb07ace72e5e95b9fc48c4300f2c72648dc693f03f09
  http/exploit-8.http: 7b78352d75ccdeef67f8aec67bab26103de649f228ca99999e655317fcbb7916
  http/exploit-9.http: 09d2949ef97219ecd62728fcb4d43d222af1b514e727043d12d41f6f21feb39d
build_signature: ceedb835472c208fcac37ef4c85e53bccc8d38a4c8e9e32df6df190a4e892e89
last_readme_fingerprint: cadc3ae309479041eaa679fd4887cafefd65c7fc6d33cd754600abc5af7d6965
